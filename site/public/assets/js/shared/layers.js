ShiftCodesTK.layers={layerListeners:{},activeLayers:{},layerTimeouts:{},layerEvents:{focus:{true:["mouseover","focusin"],false:["mouseleave","mouseout","focusout"]},click:["click","contextmenu"],resync:["resize","scroll","mousemove"]},layerContainer:dom.find.id("layers"),getLayerProps:function(g){try{!function(){if(void 0===g||!g||!dom.has(g,"class","layer"))throw"Provided layer is not a valid layer."}();var i={},t=!!g.id&&this.activeLayers[g.id];return t?i=t:(i.id=g.id,i.name=dom.get(g,"attr","data-layer-name"),i.active=!1,i.type=dom.has(g,"class","dropdown")?"dropdown":!!dom.has(g,"class","tooltip")&&"tooltip",i.triggers=function(){if(e=dom.get(g,"attr","data-layer-triggers")){var t=["focus","primary-click","secondary-click"],e=e.split(", ");for(var r in e){var a=e[r];-1==t.indexOf(a)&&(console.warn('layers.getLayerProps Warning: "'.concat(a,'" is not a valid trigger.')),e.splice(r,1))}return e}var o={dropdown:["primary-click"],tooltip:["focus"]};return o[i.type]?o[i.type]:[]}(),i.position=((o={pos:dom.get(g,"attr","data-layer-pos"),align:dom.get(g,"attr","data-layer-align"),isSticky:dom.has(g,"class","sticky"),useCursor:dom.has(g,"class","use-cursor"),followCursor:dom.has(g,"class","follow-cursor")}).pos||(o.pos="top"),o.align||(o.align="center"),o),i.target=function(){var t="data-layer-target",e="layer-target",r="data-layer-targets",a=dom.get(g,"attr",t);if(a){var o=dom.find.id(a);if(o)return o}for(var i=0,n=[g.previousElementSibling,g.nextElementSibling];i<n.length;i++){var d=n[i];if(d&&dom.has(d,"class",e))return d}if(g.parentNode){var c=dom.find.child(g.parentNode,"class",e);if(c)return c}if(g.id){var l=dom.find.children(document.body,"attr",r),s=!0,u=!1,y=void 0;try{for(var f,p=l[Symbol.iterator]();!(s=(f=p.next()).done);s=!0){var v=f.value;if(dom.has(v,"attr",r,g.id))return v}}catch(t){u=!0,y=t}finally{try{s||null==p.return||p.return()}finally{if(u)throw y}}}return!1}(),i.delay=(r=dom.get(g,"attr","data-layer-delay"),a={none:50,short:250,medium:500,long:1e3},r&&a[r]?a[r]:-1!=["button","a"].indexOf(dom.get(i.target,"tag"))?a.none:a.medium),i.content=dom.find.child(g,"class","layer-content"),i.choices=!!(e=dom.find.child(g,"class","choice-list"))&&dom.find.children(e,"class","choice")),i}catch(t){return console.error("layers.getLayerProps Error: ".concat(t)),!1}var e,r,a,o},updateLayerPos:function(s,t){var e,r=1<arguments.length&&void 0!==t&&t;try{!function(){if(void 0===s||!s||!dom.has(s,"class","layer"))throw"Provided layer is not a valid layer."}();var u=this.getLayerProps(s);if(null===document.body||0==u.target||0==u.content)return!1;var n=u.position.isSticky;return!r&&s.style.top&&!u.position.followCursor&&n||(dom.has(s,"attr","data-layer-pos")||edit.attr(s,"add","data-layer-pos",u.position.pos),function(){var t,e,r,a,o={};for(var i in o=u.position.useCursor?(t=ShiftCodesTK.cursor.x,e=ShiftCodesTK.cursor.y,r={body:document.body.getBoundingClientRect(),cursor:{top:"".concat(e-8),right:"".concat(t+8),bottom:"".concat(e+8),left:"".concat(t-8)}},{top:n?"".concat(r.cursor.top,"px"):"calc(".concat(r.body.top.toString().replace("-",""),"px + ").concat(r.cursor.top,"px)"),right:"calc(100% - ".concat(r.cursor.right,"px)"),bottom:n?"calc(".concat(r.body.height,"px - ").concat(r.cursor.bottom,"px)"):"calc(".concat(r.body.top,"px + ").concat(r.body.height,"px - ").concat(r.cursor.bottom,"px)"),left:"".concat(r.cursor.left,"px")}):(a={body:document.body.getBoundingClientRect(),target:u.target.getBoundingClientRect()},{top:n?"".concat(a.target.top,"px"):"calc(".concat(a.body.top.toString().replace("-",""),"px + ").concat(a.target.top,"px)"),right:"calc(100% - ".concat(a.target.right,"px)"),bottom:n?"calc(".concat(a.body.height,"px - ").concat(a.target.bottom,"px)"):"calc(".concat(a.body.top,"px + ").concat(a.body.height,"px - ").concat(a.target.bottom,"px)"),left:"".concat(a.target.left,"px")}))s.style[i]=o[i]}(),"tooltip"!=u.type||dom.has(s,"class","wrapped")&&!r||(dom.has(s,"class","wrapped")&&r&&edit.class(s,"remove","wrapped"),e=u.content.getBoundingClientRect(),dom.find.child(u.content,"class","content-container").getBoundingClientRect().width>e.width-12&&edit.class(s,"add","wrapped")),function(){var t;function e(){var t=document.body.getBoundingClientRect(),e=u.content.getBoundingClientRect(),r={top:e.top<12,right:e.right>t.right-12,bottom:e.bottom>t.height-12,left:e.left<12};for(side in r){if(r[side])return side}return!1}function r(t){for(var e=0<arguments.length&&void 0!==t?t:"original",r=0,a=["pos","align"];r<a.length;r++){var o=a[r],i=dom.get(s,"attr","data-layer-".concat(o,"-").concat(e));i&&edit.attr(s,"update","data-layer-".concat(o),i)}}if(r(),e()&&(r("resolved"),isOverflowing=e())){if((t=u.position.align)&&!dom.has(s,"attr","data-layer-align-original")&&edit.attr(s,"add","data-layer-align-original",t),edit.attr(s,"update","data-layer-align",side),edit.attr(s,"update","data-layer-align-resolved",side),e()){var a=!0,o=!1,i=void 0;try{for(var n,d={top:["bottom","right","left"],right:["left","top","bottom"],bottom:["top","right","left"],left:["right","top","bottom"]}[isOverflowing][Symbol.iterator]();!(a=(n=d.next()).done);a=!0){var c=n.value;if(edit.attr(s,"update","data-layer-pos",c),!e()){var l=u.position.pos;return l&&!dom.has(s,"attr","data-layer-pos-original")&&edit.attr(s,"add","data-layer-pos-original",l),edit.attr(s,"add","data-layer-pos",c),edit.attr(s,"add","data-layer-pos-resolved",c)}}}catch(t){o=!0,i=t}finally{try{a||null==d.return||d.return()}finally{if(o)throw i}}}e()&&r()}}()),!0}catch(t){return console.error("layers.updateLayerPos Error: ".concat(t)),!1}},addLayerListener:function(t,r,e){var a=2<arguments.length&&void 0!==e?e:["click"];try{function o(t){var e=ShiftCodesTK.layers;e.layerListeners[t]||(e.layerListeners[t]=[]),e.layerListeners[t].push({callback:r,triggers:a})}return function(){if(void 0===t||"string"!=typeof t&&!0!==t)throw"A valid layer name must be provided.";if(void 0===r||"function"!=typeof r)throw"Provided callback is not a callable function."}(),o(!0!==t?t:"_allLayers"),!0}catch(t){return console.error("layers.addLayerListener Error: ".concat(t)),!1}},updateDropdownLayer:function(t,e,r){var a=!(2<arguments.length&&void 0!==r)||r;try{!function(){if(void 0===t||!t||!dom.has(t,"class","layer")||!dom.has(t,"class","dropdown"))throw"Provided layer is not a valid dropdown layer.";if(void 0===e||"string"!=typeof e||!dom.find.child(t,"attr","data-value",e))throw'"'.concat(e,'" is not a valid option name.')}();var o=this.getLayerProps(t),i=dom.find.child(t,"attr","data-value",e);if(a&&this.layerListenerEvent(i,t,"click"),dom.has(t,"class","auto-press")){var n=!0,d=!1,c=void 0;try{for(var l,s=o.choices[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value,y=dom.get(u,"attr","data-value");edit.attr(u,"update","aria-pressed",y==e)}}catch(t){d=!0,c=t}finally{try{n||null==s.return||s.return()}finally{if(d)throw c}}}return a&&dom.has(t,"class","auto-toggle")&&this.toggleLayer(t,!1),!0}catch(t){return console.error("layers.updateDropdownLayer Error: ".concat(t)),!1}},toggleLayer:function(t,e){var r=1<arguments.length&&void 0!==e?e:"toggle";try{!function(){if(void 0===t||!t||!dom.has(t,"class","layer"))throw"Provided layer is not a valid layer.";if(!dom.has(t,"class","configured")){if(dom.has(t,"class","no-auto-config"))throw"Provided layer has not been configured.";t=this.setupLayer(t)}if(-1==[!0,!1,"toggle"].indexOf(r))throw'"'.concat(r,' is not a valid state."')}();var y=this.getLayerProps(t);if(null===y.id.match(new RegExp("_placeholder$"))){function a(){y.target&&"dropdown"==y.type&&(edit.attr(y.target,"update","aria-pressed",r),edit.attr(y.target,"update","aria-expanded",r))}var o="".concat(y.id,"_placeholder");if("toggle"==r&&(r=!y.active),r&&!y.active){var i=edit.copy(t);return this.layerContainer.appendChild(i),(y=this.getLayerProps(i)).active=!0,this.activeLayers[y.id]=y,a(),edit.attr(t,"update","id",o),t.innerHTML="",this.updateLayerPos(i),"dropdown"==y.type&&(function(){var t=[i.childNodes[0],i.childNodes[1]];y.target&&t.push(y.target),focusLock.set(t,function(){this.toggleLayer(i,!1)}.bind(this))}.bind(this)(),function(){if(y.choices){var t=!0,e=!1,r=void 0;try{for(var a,o=y.choices[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(dom.has(i,"attr","aria-pressed","true"))return i.focus()}}catch(t){e=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw r}}var n=!0,d=!1,c=void 0;try{for(var l,s=y.choices[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value;if(!u.disabled)return u.focus()}}catch(t){d=!0,c=t}finally{try{n||null==s.return||s.return()}finally{if(d)throw c}}}}()),setTimeout(function(){isHidden(i,!1)}.bind(this),25),!0}if(!r&&y.active){var n=dom.find.id(o);return delete this.activeLayers[y.id],a(),isHidden(t,!0),n&&(edit.attr(t,"remove","id"),edit.attr(n,"update","id",y.id),n.innerHTML=t.innerHTML),"dropdown"==y.type&&(focusLock.clear(),y.target.focus()),setTimeout(function(){deleteElement(t)}.bind(this),125),!0}}return!1}catch(t){return console.error("layers.toggleLayer Error: ".concat(t)),null}},layerListenerEvent:function(t,r,e){try{var a=function(){var t=this.getLayerProps(r),e=[];return this.layerListeners._allLayers&&(e=e.concat(this.layerListeners._allLayers)),t.name&&this.layerListeners[t.name]&&(e=e.concat(this.layerListeners[t.name])),e}.bind(this)();if(a){var o=!0,i=!1,n=void 0;try{for(var d,c=a[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var l=d.value,s={focus:this.layerEvents.focus.true.concat(this.layerEvents.focus.false),click:["click"],contextmenu:["contextmenu"]};for(var u in s){var y=s[u];-1!=l.triggers.indexOf(u)&&-1!=y.indexOf(e)&&l.callback(t,r)}}}catch(t){i=!0,n=t}finally{try{o||null==c.return||c.return()}finally{if(i)throw n}}}return!0}catch(t){return console.error("layers.layerListenerEvent Error: ".concat(t)),!1}},layerEvent:function(a){var t,e,c=ShiftCodesTK.layers,o=a.type;if(-1!=c.layerEvents.focus.true.concat(c.layerEvents.focus.false,c.layerEvents.click).indexOf(o)){var r,i,n,d="data-layer-targets",l=((e=dom.get(a.target,"attr",d))||-1==["mouseover","mouseout","touchstart","touchend","click","contextmenu"].indexOf(o)||(t=dom.find.parent(a.target,"attr",d))&&(e=dom.get(t,"attr",d)),e),s=function(){if(dom.has(a.target,"class","action"))return a.target;if(-1!=c.layerEvents.focus.true.concat(c.layerEvents.click).indexOf(o)){var t=dom.find.parent(a.target,"class","action");if(t)return t}return!1}();if(l){var u=l.split(", "),y=!0,f=!1,p=void 0;try{for(var v,g=u[Symbol.iterator]();!(y=(v=g.next()).done);y=!0)!function(){var n,t,e,r=v.value,d=dom.find.id(r);d&&(n=c.getLayerProps(d),-1!=c.layerEvents.focus.true.concat(c.layerEvents.focus.false).indexOf(o)?-1!=n.triggers.indexOf("focus")&&(t=function(){var t=ShiftCodesTK.cursor.target;return t===n.target||dom.find.parent(t,"class","layer-target")===n.target},"mouseover"==o||"focusin"==o?-1!=(-1!=n.triggers.indexOf("primary-click")||n.triggers.indexOf("secondary-click"))&&dom.has(a.target,"attr","aria-pressed","true")||(void 0===c.layerTimeouts[n.id]&&(c.layerTimeouts[n.id]=[]),c.layerTimeouts[n.id].push(setTimeout(function(){setTimeout(function(){t()&&c.toggleLayer(d,!0)},10)},n.delay))):-1!=["mouseleave","mouseout","focusout"].indexOf(o)&&(e=function(){if(c.layerTimeouts[n.id]){var t=!0,e=!1,r=void 0;try{for(var a,o=c.layerTimeouts[n.id][Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;clearTimeout(i)}}catch(t){e=!0,r=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw r}}delete c.layerTimeouts[n.id]}c.toggleLayer(d,!1)},"mouseout"==o?setTimeout(function(){t()||e()},10):e())):"click"==o?(-1!=n.triggers.indexOf("primary-click")||-1!=n.triggers.indexOf("secondary-click")&&n.active)&&c.toggleLayer(d):"contextmenu"==o&&-1!=n.triggers.indexOf("secondary-click")&&(a.preventDefault(),n.active?c.updateLayerPos(d,!0):c.toggleLayer(d,!0)))}()}catch(t){f=!0,p=t}finally{try{y||null==g.return||g.return()}finally{if(f)throw p}}}!s||(r=dom.find.parent(s,"class","layer"))&&(i=c.getLayerProps(r),-1!=c.layerEvents.focus.true.concat(c.layerEvents.focus.false).indexOf(o)&&"dropdown"==i.type&&(n=dom.find.child(r,"class","choice-list"),-1!=c.layerEvents.focus.true.indexOf(o)?edit.attr(n,"update","aria-activedescendent",s.parentNode.id):setTimeout(function(){var t=ShiftCodesTK.cursor.target;t!==s&&dom.find.parent(t,"class","action")!==s&&edit.attr(n,"remove","aria-activedescendent")},10)),-1!=c.layerEvents.click.indexOf(o)&&(i&&"dropdown"==i.type?"dropdown"==i.type&&c.updateDropdownLayer(r,dom.get(s,"attr","data-value"),!0):c.layerListenerEvent(s,r,o)))}else if(-1!=c.layerEvents.resync.indexOf(o)){var h=c.activeLayers;if(0<Object.keys(h).length)for(var m in h){var b=h[m];("resize"==o||"scroll"==o&&"dropdown"!=b.type||"mousemove"==o&&b.position.followCursor)&&c.updateLayerPos(dom.find.id(b.id),"scroll"!=o)}}},setupLayer:function(n){try{if(void 0===n||!n||!dom.has(n,"class","layer"))throw"Provided layer is not a valid element.";var u=this.getLayerProps(n),d={};return d.layer=""!=u.id?u.id:randomID("layer_"),d.content="".concat(d.layer,"_content"),d.target=""!=u.target.id?u.target.id:randomID("layer_target_"),function(){var t,e,r,a,s=(t=document.createElement("div"),e=document.createElement("div"),edit.class(t,"add","layer-content"),edit.class(e,"add","content-container"),e.id=d.content,e.innerHTML=n.innerHTML,t.appendChild(e),t);n.id=d.layer,u.id=d.layer,edit.class(n,"add","configured"),edit.attr(n,"add","data-layer-target",d.target),isHidden(n,!0),"dropdown"==u.type?((a=dom.find.child(s,"class","title"))&&(r="".concat(u.id,"_title"),edit.attr(a,"add","id",r),edit.attr(n,"add","aria-labelledby",r)),function(){var t,e,r,a,o,i,n,d=function(){if(!(e=dom.find.child(s,"class","choice-list"))){var t=dom.find.children(s,"class","choice"),e=document.createElement("ul");edit.class(e,"add","choice-list");for(var r=0;r<t.length;r++)e.appendChild(t[r]);e=s.appendChild(e)}return edit.attr(e,"add","role","menu"),e}(),c=dom.find.children(d,"class","choice");if(!1!==c)for(var l=0;l<c.length;l++)n=i=o=a=r=e=void 0,i=c[t=l],n="".concat(u.id,"_choice_").concat(t),edit.class(i,"add","action"),dom.has(s,"class","auto-toggle")&&edit.attr(i,"add","aria-pressed","false"),(r=dom.find.child(i,"class","label"))&&(e="".concat(n,"_label"),edit.attr(r,"add","id",e),edit.attr(i,"add","aria-labelledby",e)),(a=dom.find.parent(i,"tag","li"))||((a=document.createElement("li")).appendChild(i),a=d.appendChild(a)),(o=a).id=n,edit.attr(o,"add","role","menuitem");else console.warn('layers.setupLayer Warning: Dropdown layer "'.concat(u.id,'" did not provide any choices.'))}()):"tooltip"==u.type&&edit.attr(n,"add","role","tooltip");var o,i=(o=document.createElement("div"),edit.class(o,"add","pointer box-icon fas fa-caret-up"),edit.attr(o,"add","aria-hidden",!0),o);n.innerHTML="",n.appendChild(s),n.appendChild(i)}(),function(){if(!u.target)throw'A target could not be found for layer "'.concat(u.id,'".');var t,e={id:d.target,autocomplete:!1,"data-layer-targets":!1!==(t=dom.get(u.target,"attr","data-layer-targets"))?"".concat(t,", ").concat(d.layer):d.layer};for(var r in"dropdown"==u.type?e=mergeObj(e,{"aria-haspopup":"menu","aria-expanded":!1,"aria-pressed":!1}):"tooltip"==u.type&&(e["aria-describedby"]=d.content),e)edit.attr(u.target,"update",r,e[r])}(),n}catch(t){return console.error("layers.toggleLayer Error: ".concat(t)),!1}}},function(){var t=ShiftCodesTK.layers;window.addEventListener("load",function(){(function(){var t=dom.find.children(document.body,"class","layer"),e=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var n=o.value;dom.has(n,"class","configured")||dom.has(n,"class","no-auto-config")||this.setupLayer(n)}}catch(t){r=!0,a=t}finally{try{e||null==i.return||i.return()}finally{if(r)throw a}}}).bind(t)()}),function(){var t=this.layerEvents.focus.true.concat(this.layerEvents.focus.false,this.layerEvents.click,this.layerEvents.resync),e=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var n=o.value;window.addEventListener(n,this.layerEvent,!0)}}catch(t){r=!0,a=t}finally{try{e||null==i.return||i.return()}finally{if(r)throw a}}}.bind(t)()}();