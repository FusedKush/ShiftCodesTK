function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);function r(){}var o=0;return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,d=!0,n=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return d=e.done,e},e:function(e){n=!0,i=e},f:function(){try{d||null==a.return||a.return()}finally{if(n)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}!function(){var p=setInterval(function(){var e,M,v,i,q,y,o,t,d,a,r,n,s,l,c,f,u,g;"undefined"!=typeof ShiftCodesTK&&ShiftCodesTK.forms.isLoaded&&ShiftCodesTK.requests.isLoaded&&pagers.isLoaded&&(clearInterval(p),e=moment.utc().valueOf(),M=ShiftCodesTK.forms,v=ShiftCodesTK.layers,i=ShiftCodesTK.modals,(q=ShiftCodesTK.requests).request,y=ShiftCodesTK.toasts,ShiftCodesTK.local.shift={stats:{total:0,new:0,expiring:0},props:function(){var e={game:!1,status:["active"],platform:!1,owner:!1,code:!1,order:"default",limit:10,page:1};for(var t in e){var a=e[t];e[t]={value:a,defaultValue:a,isLocked:!1}}return e}(),request:null,updateCheck:{intervalID:0,intervalDuration:2,updateStats:{first:e,last:e},toggleIndicator:function(e,t){var a=1<arguments.length&&void 0!==t?t:0;try{var r=dom.find.id("shift_update_indicator");if(r){var o=dom.find.child(r,"class","counter"),i=dom.get(r,"attr","aria-label");return o.innerHTML=a,updateLabel(r,i.replace(new RegExp("\\d+"),a),["aria","tooltip"]),e?(isHidden(r,!1),edit.class(r,"remove","hidden")):(edit.class(r,"add","hidden"),setTimeout(function(){isHidden(r,!0)},250)),!0}throw"Indicator is missing"}catch(e){return console.error("local.shift.updateCheck.toggleIndicator Error: ".concat(e)),!1}},updateLastTimestamp:function(){try{var e=moment.utc().valueOf();return this.updateStats.last=e}catch(e){return console.error("local.shift.updateCheck.updateLastTimestamp Error: ".concat(e,".")),!1}},start:function(){try{return this.intervalID=setInterval(this.poll,6e4*this.intervalDuration),!0}catch(e){return console.error("local.shift.updateCheck.start Error: ".concat(e)),!1}},stop:function(){try{return clearInterval(this.intervalID),!0}catch(e){return console.error("local.shift.updateCheck.stop Error: ".concat(e)),!1}},restart:function(){try{return this.stop(),this.start(),!0}catch(e){return console.error("local.shift.updateCheck.restart Error: ".concat(e)),!1}},poll:function(){var e=ShiftCodesTK.local.shift,r=e.updateCheck;return newAjaxRequest({file:"/assets/requests/get/shift/updates",params:{last_check:moment.utc(r.updateStats.last).format(),game_id:e.getResultProp("game")},callback:function(e){var t,a=tryJSONParse(e);a&&(0<(t=a.payload.count)&&r.toggleIndicator(!0,t),r.updateLastTimestamp())}})},update:function(){ShiftCodesTK.local.shift.getCodes(),this.toggleIndicator(!1)}},locations:{shiftHeader:dom.find.id("shift_header"),shiftCodeList:dom.find.id("shift_code_list")},templates:{shiftCode:dom.find.id("shift_code_template")},getResultProp:function(e){try{var t=this.props[e];if(t)return t.value;throw'"'.concat(e,'" is not a valid property name')}catch(e){return console.error("local.shift.getResultProp Error: ".concat(e)),NULL}},setResultProp:function(e,t){try{var a=this.props[e];if(a&&!a.isLocked)return a.value=t,!0;if(!a)throw'"'.concat(e,'" is not a valid property name');return!1}catch(e){return console.error("local.shift.setResultProp Error: ".concat(e)),NULL}},syncShiftComponents:function(){try{var l=ShiftCodesTK.local.shift,c=dom.find.id("shift_header");if(c){l.props;return function(){var e=dom.find.child(c,"class","section badges");if(e){var t,a=_createForOfIteratorHelper(dom.find.children(e,"class","badge"));try{for(a.s();!(t=a.n()).done;){var r=t.value,o=dom.get(r,"attr","data-value"),i=ucWords(o),d=l.stats[o],n=dom.find.child(r,"class","count"),s="",s=0<d?"total"==o?"".concat(d," SHiFT Code").concat(checkPlural(d)," Available"):"".concat(d," ").concat(i," SHiFT Code").concat(checkPlural(d)):"total"==o?"No SHiFT Codes Available":"No ".concat(i," SHiFT Codes");edit.class(r,0==d?"add":"remove","inactive"),n.innerHTML=d,updateLabel(r,s,["aria","tooltip"])}}catch(e){a.e(e)}finally{a.f()}}else console.warn("local.shift.syncShiftComponents Warning: Badges are missing")}(),function(){var e=dom.find.id("shift_header_sort_filter_form");if(e){var t={sort:l.getResultProp("order"),status_filter:l.getResultProp("status"),platform_filter:l.getResultProp("platform"),game_filter:l.getResultProp("game")};if(!dom.has(e,"class","updated")){for(var a in t){var r=M.getField(e,a),o=t[a];r&&o&&M.updateField(Array.isArray(r)?r[0]:r,o)}edit.class(e,"add","updated")}}else console.warn("local.shift.syncShiftComponents Warning: Sorting & Filtering Form is missing.")}(),e=dom.find.id("shift_code_pager"),t={limit:l.getResultProp("limit"),offset:l.getResultProp("page"),total:l.stats.total},a={now:t.offset,max:0<t.total?Math.ceil(t.total/t.limit):1},updatePagerProps(e,a),!0}throw"SHiFT Header is missing."}catch(e){return console.error("local.shift.syncShiftComponents Error: ".concat(e,".")),!1}var e,t,a},syncQueryParams:function(e){var t,d,a=0<arguments.length&&void 0!==e?e:"query",n=this;if("query"==a){var r={},r=mergeObj(r,getQueryParameters());for(var o in n.props)t=o,d=void 0,d=n.props[t],function(){if(!d.isLocked&&(Array.isArray(d.value)?!function(){var e,t=_createForOfIteratorHelper(d.value);try{for(t.s();!(e=t.n()).done;){var a=e.value;if(-1==d.defaultValue.indexOf(a))return}}catch(e){t.e(e)}finally{t.f()}var r,o=_createForOfIteratorHelper(d.defaultValue);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(-1==d.value.indexOf(i))return}}catch(e){o.e(e)}finally{o.f()}return 1}():d.value!=d.defaultValue))return!0;return!1}()?r[t]=d.value:void 0!==r[t]&&delete r[t];return updateQueryParameters(r,"new"),r}if("var"==a){var i=function(){var e,t,a,r,o=getQueryParameters();for(var i in n.props)e=i,r=a=t=void 0,a=n.props[e],void 0!==(r=(t=o[e])&&-1!=["limit","page"].indexOf(e)?tryParseInt(t):t)&&o[e]!=a?n.setResultProp(e,r):void 0===r&&n.setResultProp(e,n.props[e].defaultValue);return{v:n.props}}();if("object"===_typeof(i))return i.v}return!1},redeemShiftCode:function(e,t){var a,n=!(1<arguments.length&&void 0!==t)||t;try{function r(e){var t,a,r,o,i=dom.find.child(e,"class","action redeem"),d=dom.find.child(i,"class","redeem");edit.class(e,n?"add":"remove","redeemed"),d&&(a={icon:[n?"fa-bookmark":"fa-check",n?"fa-check":"fa-bookmark"],title:[n?"redeemed":"unredeemed",n?"unredeemed":"redeemed"]},r="Mark this SHiFT Code as redeemed",o='Mark this SHiFT Code as&nbsp;<em>redeemed</em>\n                            <br>\n                            <br><button class="link no-color modal-toggle" data-modal="shift_code_redeeming_codes_info_modal"><strong>Learn More</strong></button>',d.innerHTML=(t=d.innerHTML).replace.apply(t,_toConsumableArray(a.icon)),d.disabled||(edit.attr(d,"update","aria-pressed",n),updateLabel(d,r.replace.apply(r,_toConsumableArray(a.title)),["aria"]),updateLabel(d,o.replace.apply(o,_toConsumableArray(a.title)),["tooltip"])))}var o="string"==typeof e&&12==e.length?"codeHash":!("object"!=_typeof(e)||-1==e.constructor.name.indexOf("Element")||!dom.has(e,"class","shift-code"))&&"panel";if(!o)throw"Provided SHiFT Code is not a valid SHiFT Code Dropdown Panel or Code Hash ID";if("panel"==o)r(e);else if("codeHash"==o){var i=dom.find.children(this.locations.shiftCodeList,"attr","data-code-hash",e);if(!i)throw'No present SHiFT Codes match the provided code hash: "'.concat(e,'".');!function(e,t){var a,r=_createForOfIteratorHelper(e);try{for(r.s();!(a=r.n()).done;){var o=a.value,i=dom.find.child(o,"class","action redeem");i&&(isDisabled(i,!t),edit.class(i,t?"remove":"add","in-progress"))}}catch(e){r.e(e)}finally{r.f()}}(i,!0);var d,s,l=_createForOfIteratorHelper(i);try{for(l.s();!(d=l.n()).done;){r(d.value)}}catch(e){l.e(e)}finally{l.f()}n&&responseData.payload.form_response&&(s=1==(a=response.payload.toastType)?"This SHiFT Code has been redeemed successfully! Redeemed SHiFT Codes will be marked anytime you visit ShiftCodesTK from your current browser. If your browser cookies are deleted, your redeemed SHiFT Codes may be lost.":2==a?"This SHiFT Code has been redeemed successfully! Redeemed SHiFT Codes will be marked anytime you visit ShiftCodesTK as long as you are logged in.":void 0,ShiftCodesTK.toasts.newToast({settings:{id:"redeemed_code_toast",duration:"infinite"},content:{icon:"fas fa-key",title:"SHiFT Code Redeemed!",body:s},actions:[{content:"Learn More",link:"#/help/redeeming-shift-codes"}]}))}}catch(e){return console.error("local.shift.redeemShiftCode Error: ".concat(e)),!1}},updateShiftCodeTimestamp:function(r,e){var t=1<arguments.length&&void 0!==e?e:void 0,a=function(){var e=dom.find.child(r,"class","code-info");if(e){var t=dom.find.child(e,"class","last-update");if(t){var a=dom.find.child(t,"tag","dd");if(a)return a}}return!1}();if(a){var o=moment.utc(t);if(o){var i=o.format("MMMM DD, YYYY hh:mm A [UTC]");return a.innerHTML=o.fromNow(),updateLabel(a,i,["aria","tooltip"]),i}}return!1},toggleControls:function(e){try{var t,a=this,r=(n=dom.find.child(a.locations.shiftHeader,"class","section badges"),[dom.find.child(n,"class","new"),dom.find.child(n,"class","expiring"),dom.find.id("shift_header_add"),dom.find.id("shift_header_sort_filter"),dom.find.id("shift_code_pager")]),o=0,i=_createForOfIteratorHelper(r);try{for(i.s();!(t=i.n()).done;){var d=t.value;d&&!dom.has(d,"class","inactive")&&(isDisabled(d,!e),o++)}}catch(e){i.e(e)}finally{i.f()}if(0==o)throw"No controls were found on this page";return!0}catch(e){return console.error("local.shift.toggleControls Error: ".concat(e)),!1}var n},updateOverlay:function(e){var t={};for(var a in t.overlay=dom.find.id("shift_overlay"),t.spinner=dom.find.child(t.overlay,"class","spinner"),t.error=dom.find.child(t.overlay,"class","error"),t){var r=e[a];isHidden(t[a],!r)}return!0},clearShiftCodes:function(){for(var e=dom.find.children(this.locations.shiftCodeList,"class","shift-code"),t=e.length,a=e.length-1;0<=a;a--)deleteElement(e[a]);return t},createShiftCodePanel:function(u){try{var e=this,s=edit.copy(e.templates.shiftCode),p={header:dom.find.child(s,"class","header"),body:dom.find.child(s,"class","body")},l={baseElementID:"shift_code"};return l.codeID=u.properties.code.id,l.elementID="".concat(l.baseElementID,"_").concat(l.codeID),s.id=l.elementID,edit.attr(s,"add","data-code-id",l.codeID),(codeHash=u.properties.code.hash)&&edit.attr(s,"add","data-code-hash",codeHash),function(){var e,t=["id","for","data-view","data-target","data-layer-target","data-layer-targets","aria-labelledby","aria-describedby"],a=_createForOfIteratorHelper(s.querySelectorAll("[".concat(t.join("], ["),"]")));try{for(a.s();!(e=a.n()).done;){var r,o=e.value,i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var d=r.value,n=dom.get(o,"attr",d);!1!==n&&""!=n&&edit.attr(o,"update",d,function(e){var t=e.split(", ");for(var a in t)t[a]="".concat(l.elementID,"_").concat(t[a]);return t.join(", ")}(n))}}catch(e){i.e(e)}finally{i.f()}}}catch(e){a.e(e)}finally{a.f()}}(),dropdownPanelSetup(s),multiView_setup(p.body),M.setupChildForms(s),dom.find.child(p.header,"class","reward").innerHTML=u.info.reward,w=u.properties.code.state,x=u.states,0==u.info.reward.trim().search(new RegExp("\\d{1} Golden Key(s){0,1}$"))?edit.class(s,"add","basic"):edit.class(s,"add","rare"),x.code.isActive&&"active"==w?(x.code.isNew&&edit.class(s,"add","new"),x.code.isExpiring&&edit.class(s,"add","expiring")):"hidden"==w&&edit.class(s,"add","hidden"),x.code.isActive||edit.class(s,"add","expired"),q.savedRequests.getRequestParameter("FetchShiftCodes","game")||(T=dom.find.child(p.header,"class","label game-label"),F=u.properties.game_id,H=shiftNames[F],edit.class(s,"add","game-label"),edit.class(T,"add",F),T.innerHTML=T.innerHTML.replace("Borderlands",H),updateLabel(T,"This SHiFT Code is redeemable for ".concat(H),["aria","tooltip"])),x.code.wasRecentlySubmitted?edit.class(s,"add","recently-submitted"):x.code.wasRecentlyUpdated&&edit.class(s,"add","recently-updated"),x.user.isOwner&&edit.class(s,"add","owned"),R=dom.find.child(p.header,"class","progress-bar"),P=dom.find.child(R,"class","progress"),O=0,I="",I="date"==u.info.release_date.type&&-1!=["through","until"].indexOf(u.info.expiration_date.type)?(D=(L=moment.utc(u.info.expiration_date.value)).diff(u.info.release_date.value,"hours"),E=L.diff(moment.utc(),"hours"),k=L.fromNow(!0),u.states.code.isActive?(O=100-Math.round(E/D*100),ucWords("".concat(k," Remaining"))):(O=100,ucWords("Expired ".concat(k," Ago")))):(edit.class(R,"add","inactive"),O=0,"infinite"==u.info.expiration_date.type?"No Expiration Date":"No Provided Release/Expiration Date"),updateProgressBar(R,O,{useWidth:!0}),updateLabel(R,I,["tooltip"]),edit.class(P,"add",u.properties.game_id),function(){var o={dates:{}};o.dates.date="MMM DD, YYYY",o.dates.expandedDate="MMMM DD, YYYY",o.dates.time="h:mm A zz",o.dates.full="".concat(o.dates.date," ").concat(o.dates.time),o.dates.expanded="".concat(o.dates.expandedDate," ").concat(o.dates.time),o.calendars={sameDay:"[Today]",nextDay:"[Tomorrow]",nextWeek:"dddd",lastDay:"[Yesterday]",lastWeek:"[Last] dddd"};var a={release:{}};for(var e in a.release.formats=function(){var e={simple:{},full:{},expanded:{}},t=o.dates,a=o.calendars;for(var r in a)e.simple[r]="".concat(a[r]),e.full[r]="".concat(a[r],", ").concat(t.date),e.expanded[r]="".concat(a[r],", ").concat(t.expandedDate);return e.simple.sameElse=e.full.sameElse=t.date,e.expanded.sameElse="dddd, ".concat(t.expandedDate),e}(),a.release.type=u.info.release_date.type,a.release.dates=function(){var e=u.info.release_date.value;if("date"!=a.release.type)return!1;var t=moment(e);return{simple:t.calendar(null,a.release.formats.simple),full:t.calendar(null,a.release.formats.full),expanded:t.calendar(null,a.release.formats.expanded)}}(),a.expiration={},a.expiration.formats=function(){var e={simple:{},full:{},expanded:{}},t=o.dates,a=o.calendars;for(var r in a)e.simple[r]="".concat(a[r],", ").concat(t.time),e.full[r]="".concat(a[r],", ").concat(t.full),e.expanded[r]="".concat(a[r],", ").concat(t.expanded);return e.simple.sameElse=e.full.sameElse=t.full,e.expanded.sameElse="dddd, ".concat(t.expanded),e}(),a.expiration.type=u.info.expiration_date.type,a.expiration.dates=function(){var e=u.info.expiration_date.value;if(-1==["through","until"].indexOf(a.expiration.type))return!1;var t=moment.tz(e,u.info.timezone);return{simple:t.calendar(null,a.expiration.formats.simple),full:t.calendar(null,a.expiration.formats.full),expanded:t.calendar(null,a.expiration.formats.expanded)}}(),a){var t=a[e].type,r=a[e].dates,i={};i.main=A(e),i.simple=dom.find.child(i.main,"class","simple"),i.full=dom.find.child(i.main,"tag","dd"),r?(r.simple!=r.full?i.simple.firstChild.innerHTML=r.simple:deleteElement(i.simple),i.full.innerHTML=r.full,updateLabel(i.full,r.expanded,["tooltip"])):(edit.class(i.main,"add","inactive"),deleteElement(i.simple),"none"==t?(i.full.innerHTML="N/A",updateLabel(i.full,"No ".concat(ucWords(e)," Date was provided"),["tooltip"])):"infinite"==t&&(i.full.innerHTML="Never Expires",updateLabel(i.full,"This SHiFT Code is set to never expire",["tooltip"])))}}(),m=A("source"),h=dom.find.child(m,"class","online-source"),v=dom.find.child(m,"class","physical-source"),y=u.info.source.type,g=u.info.source.value,"none"!=y?"online"==y?(h.href=g,h.innerHTML+=g,deleteElement(v.nextElementSibling),deleteElement(v)):"physical"==y&&(v.innerHTML=g,deleteElement(h.nextElementSibling),deleteElement(h)):(edit.class(m,"add","inactive"),v.innerHTML="N/A",updateLabel(v,"A source was not provided for this SHiFT Code",["title","tooltip"]),deleteElement(h.nextElementSibling),deleteElement(h)),C=A("notes"),null!==(S=u.info.notes)?(_=dom.find.child(C,"tag","ul"),b=-1!=S.indexOf("-")?S.replace(new RegExp("-.*","g"),function(e){return"".concat(e.replace(new RegExp("-\\s{1}","g"),"<li>"),"</li>")}):"<li>".concat(S,"</li>"),_.innerHTML=b):deleteElement(C.parentNode),function(){var v,f,e,t,a,r,o,i,y,d,g=ShiftCodesTK.shift.platforms,n=u.codes.shift_codes,s=u.codes.platforms,l=dom.find.child(p.body,"class","shift-code");for(var c in n)y=i=o=r=a=t=e=f=void 0,i=n[v=c],y=s[v],i&&y&&(f=edit.copy(l),a=function(){if("universal"==v)return{title:"Universal SHiFT Code",tooltip:"This SHiFT Code can be redeemed for all supported platforms"};var e=g[v];if(e){var t=e.display_name;if(t)return{title:"".concat(t," SHiFT Code"),tooltip:"This SHiFT Code can be redeemed for <strong>".concat(t,"</strong> platforms")}}}(),r=dom.find.child(f,"class","platform-family"),o=r.nextElementSibling,r.innerHTML=a.title,updateLabel(r,a.tooltip.replace(new RegExp("\\<strong(?:\\/){0,1}\\>","g"),""),["aria"]),o.innerHTML=a.tooltip,function(){var e,t=function(){var e=[];if("universal"==v)for(var t=0,a=Object.keys(g);t<a.length;t++){var r=a[t],o=g[r];if(o){var i,d,n=o.platforms;if(n)for(var s in n){-1!=y.indexOf(s)&&(!(i=n[s])||(d=i.display_name)&&e.push(d))}}}else{var l,c=_createForOfIteratorHelper(y);try{for(c.s();!(l=c.n()).done;){var f,u,p,m=l.value,h=g[v];!h||(f=h.platforms)&&(!(u=f[m])||(p=u.display_name)&&e.push(p))}}catch(e){c.e(e)}finally{c.f()}}return e}(),a=dom.find.child(f,"class","platform-list"),r=dom.find.child(a,"tag","li"),o=_createForOfIteratorHelper(t);try{for(o.s();!(e=o.n()).done;){var i=e.value,d=edit.copy(r),n=dom.find.child(d,"class","platform"),s=dom.find.child(n,"tag","span"),l=dom.find.child(d,"class","tooltip"),c="This SHiFT Code can be redeemed for <strong>".concat(i,"</strong>.");updateLabel(d,c.replace(new RegExp("\\<(?:\\/){0,1}strong\\>","g"),""),["aria"]),edit.class(n,"add",u.properties.game_id),s.innerHTML=i,l.innerHTML=c,a.appendChild(d)}}catch(e){o.e(e)}finally{o.f()}deleteElement(r)}(),(t=dom.find.child(f,"class","code")).innerHTML=i,edit.class(dom.find.parent(t,"class","content"),"add",u.properties.game_id),e=dom.find.child(f,"class","copy-to-clipboard"),edit.class(e,"add",u.properties.game_id),l.insertAdjacentElement("beforebegin",f));d=dom.find.child(p.body,"class","shift-code-usage"),dom.find.child(d,"class","in-game").href+="/".concat(u.properties.game_id),deleteElement(l)}(),f=dom.find.child(p.body,"class","footer"),(i={}).container=dom.find.child(f,"class","actions"),i.share=dom.find.child(i.container,"class","share"),i.redeem=dom.find.child(i.container,"class","redeem"),i.optionsMenu=dom.find.child(i.container,"class","options-menu"),u.states.code.isActive?(a=dom.find.child(i.share,"tag","form"),r=M.getField(a,"share_link"),M.updateField(r,"https://".concat(window.location.host,"/").concat(u.properties.game_id,"?code=").concat(u.properties.code.id),{updateDefault:!0}),function(){var e=dom.find.child(i.redeem,"tag","form"),t={code:u.properties.code.hash,action:u.states.user.hasRedeemed?"remove":"redeem"};for(var a in t){var r=t[a],o=M.getField(e,a);o&&(Array.isArray(o)?M.updateField(o[0],r):M.updateField(o,r))}}()):(isDisabled(dom.find.child(i.share,"tag","button"),!0),isDisabled(dom.find.child(i.redeem,"tag","button"),!0)),(c={}).container=dom.find.child(f,"class","code-info"),c.id=dom.find.child(c.container,"class","id"),c.lastUpdate=dom.find.child(c.container,"class","last-update"),c.owner=dom.find.child(c.container,"class","owner"),t("id",o=u.properties.code.id,"SHiFT Code<br><i>#".concat(o,"</i>")),e.updateShiftCodeTimestamp(s,u.info.last_update),u.states.user.canEdit?(d=u.properties.owner.username,n=u.properties.owner.id,t("owner",d,"".concat(d,"<br><i>#").concat(n,"</i>"))):deleteElement(c.owner),function(){var e,t,a,r,o,i,d=_createForOfIteratorHelper(dom.find.children(s,"class","shift-code-options-menu"));try{for(d.s();!(e=d.n()).done;)i=o=r=a=t=void 0,o=e.value,(i={}).codeID=dom.find.child(o,"class","code-id"),i.share=dom.find.child(o,"attr","data-value","share"),i.report=dom.find.child(o,"attr","data-value","report"),i.editActions=dom.find.child(o,"class","edit-actions"),i.visibilityForm=dom.find.child(i.editActions,"attr","data-form-name","toggle_shift_code_visibility_form"),i.makePublic=dom.find.child(i.visibilityForm,"attr","data-value","make_public"),i.makePrivate=dom.find.child(i.visibilityForm,"attr","data-value","make_private"),i.deleteForm=dom.find.child(i.editActions,"attr","data-form-name","delete_shift_code_form"),edit.attr(o,"add","data-code-id",l.codeID),i.codeID.innerHTML=l.codeID,u.states.user.isOwner&&(isDisabled(i.report),updateLabel(i.report,"You cannot report your own SHiFT Code.",["aria","tooltip"])),u.states.user.canEdit?(a="active"==u.properties.code.state?i.makePublic:i.makePrivate,r=M.getField(i.visibilityForm,"code_id"),M.updateField(r,l.codeID),isHidden(a,!0),isDisabled(a,!0),t=M.getField(i.deleteForm,"code_id"),M.updateField(t,l.codeID,{updateDefault:!0})):deleteElement(i.editActions)}catch(e){d.e(e)}finally{d.f()}}(),ShiftCodesTK.layers.setupChildLayers(s),u.states.user.hasRedeemed&&e.redeemShiftCode(s,!0),s}catch(e){return console.error("local.shift.createShiftCodePanel Error: ".concat(e)),!1}function t(e,t,a){var r=2<arguments.length&&void 0!==a&&a,o=dom.find.child(c[e],"tag","dd");o.innerHTML=t,r&&updateLabel(o,r,["tooltip"])}var a,r,i,o,d,n,c,f,m,h,v,y,g,_,b,C,S,T,F,H,w,x,L,D,E,k,R,P,O,I;function A(e){var t=dom.find.child(p.body,"class","section ".concat(e));return dom.find.child(t,"class","content")}},fetchShiftCodes:function(){return this.toggleControls(!1),this.updateOverlay({overlay:!0,spinner:!0,error:!1}),lpbUpdate(50,!0,{start:15}),this.updateCheck.stop(),this.clearShiftCodes(),!0}},u=ShiftCodesTK.local.shift,g=ShiftCodesTK.requests,function(){var e=u.locations.shiftCodeList,t=tryJSONParse(dom.get(e,"attr","data-shift"));if(t)for(var a in u.props){var r=t[a],o=u.props[a];void 0!==r&&(r!=o&&(u.setResultProp(a,r),o.defaultValue=r),t.lockedProperties&&-1!=t.lockedProperties.indexOf(a)&&(u.props[a].isLocked=!0))}}(),t={type:"pagination",request:{path:"/assets/requests/get/shift/codes",callback:function(i,e){i&&200==i.statusCode?(lpbUpdate(85,!0,{start:50}),setTimeout(function(){var e=i.payload.shift_codes;if(e){var t=e.flag_counts;if(t&&u.stats!=t&&(u.stats=t,u.syncShiftComponents()),e&&0<e.length){for(var a=0;a<e.length;a++){var r=e[a],o=u.createShiftCodePanel(r);o&&(o.style.animationDelay="".concat(.2*a,"s"),u.locations.shiftCodeList.appendChild(o))}u.updateOverlay({overlay:!1})}else u.updateOverlay({overlay:!0,spinner:!1,error:!0});u.updateCheck.start(),setTimeout(function(){u.toggleControls(!0),lpbUpdate(100)},500)}},50)):(lpbUpdate(100),u.updateOverlay({overlay:!0,spinner:!1,error:!0}),ShiftCodesTK.toasts.newToast({settings:{template:"fatalException"},content:{title:"SHiFT Code Downloading Error",body:"We could not retrieve any SHiFT Codes due to an error. Please refresh the page and try again."}}))},params:{get_result_set_data:!0,get_flag_counts:!0}},controls:{sortAndFilter:dom.find.id("shift_header_sort_filter_form"),pager:dom.find.id("shift_code_pager"),controlsState:[dom.find.id("shift_header_add"),dom.find.id("shift_header_sort_filter"),dom.find.id("shift_code_pager")]},syncParameters:"replace"},d=u.locations.shiftCodeList,a=tryJSONParse(dom.get(d,"attr","data-shift")),o={game:null,status:["active"],platform:null,owner:null,code:null,order:"default",limit:10,page:1},function(){var e=tryJSONParse(dom.get(d,"attr","data-shift"));if(e){for(var t in o){var a=e[t],r=u.props[t];void 0!==a&&a!=r&&(o[t]=a)}edit.attr(d,"remove","data-shift")}}(),r=o,g.savedRequests.saveRequest("FetchShiftCodes",t,r,a.readOnlyProperties?a.readOnlyProperties:[]),g.savedRequests.saveRequest("GetShiftCode",{request:{path:"/assets/requests/get/shift/codes",params:{game:null,status:["active","expired","hidden"],limit:1,page:1}}},{status:["active","expired","hidden"],owner:null,code:null}),n="FetchShiftCodes",addHashListener("shift_code_d{12}$",function(e){g.savedRequests.setRequestParameter(n,"page",1),g.savedRequests.setRequestParameter(n,"code",e.replace("#shift_code_","")),g.request(n),g.savedRequests.setRequestParameter(n,"code",null)})||g.request(n),s=moment.utc().valueOf(),u.updateCheck.updateStats={first:s,last:s},window.addEventListener("tkRequestsRequestDispatched",function(e){var t=ShiftCodesTK.requests.savedRequests.getRequest("FetchShiftCodes").configuration.request.path;-1!=e.requestEventData.request.requestEventData.requestProperties.path.indexOf(t)&&(u.toggleControls(!1),u.updateOverlay({overlay:!0,spinner:!0,error:!1}),lpbUpdate(50,!0,{start:15}),u.updateCheck.stop(),u.clearShiftCodes())}),f=dom.find.child(u.locations.shiftHeader,"class","slideout"),(c=dom.find.id("shift_header_sort_filter"))?(c.addEventListener("click",function(e){isHidden(f)}),(l=dom.find.child(f,"tag","form"))?(M.getField(l,"game").addEventListener("tkFormsFieldCommit",function(e){var t,a=e.formEventData.fieldValue,r=_createForOfIteratorHelper(M.getField(l,"platform_filter"));try{for(r.s();!(t=r.n()).done;){var o=t.value;""!==a&&-1==ShiftCodesTK.shift.games[a].support.unsupported.platforms.indexOf(o.value)||isDisabled(o,""!==a)}}catch(e){r.e(e)}finally{r.f()}}),l.addEventListener("tkFormsFormAfterSubmit",function(e){var t=e.formEventData;console.log(t)})):console.warn("local.shift Setup Warning: Sort/Filter Form is missing")):console.warn("local.shift Setup Warning: Sort/Filter Header Button is missing"),window.addEventListener("click",function(e){dom.has(e.target,"class","update-indicator",null,!0)&&u.updateCheck.update()}),window.addEventListener("tkFormsFormAfterSubmit",function(e){var t=e.formEventData;if("redeem_shift_code_form"==t.formProps.info.name){var r=t.formData;return t.formResponseData&&200==t.formResponseData.statusCode?(setTimeout(function(){var e,t=_createForOfIteratorHelper(dom.find.children(u.locations.shiftCodeList,"class","shift-code"));try{for(t.s();!(e=t.n()).done;){var a=e.value;dom.has(a,"attr","data-hash",r.code)&&u.redeemShiftCode(a)}}catch(e){t.e(e)}finally{t.f()}},500),!0):(e.preventDefault(),ShiftCodesTK.toasts.newToast({setting:{duration:"long"},content:{title:"Failed to ".concat("redeem"==r.action?"Redeem":"Unredeem"," SHiFT Code"),body:"SHiFT Code (".concat(r.code,") could not be ").concat("redeem"==r.action?"redeemed":"unredeemed"," due to an error. Please try again.")}}),!1)}}),v.addLayerListener("shift_code_options_menu",function(f,u){var p=dom.get(f,"attr","data-value"),m=dom.get(u,"attr","data-code-id");function h(e){edit.class(f,e?"add":"remove","spinning"),edit.attr(f,"update","aria-pressed",e),isDisabled(f,e)}m&&(h(!0),setTimeout(function(){if("edit"==p){function e(e){var t=0<arguments.length&&void 0!==e?e:"This SHiFT Code could not be edited due to an error. Please try again later.";lpbUpdate(100),edit.class(f,state?"add":"remove","spinning"),y.newToast({settings:{duration:"long",template:"fatalException"},content:{title:"Failed to edit SHiFT Code",body:t}})}var d=function(){var e=g.savedRequests.getResultData("FetchShiftCodes").lastResult;if(e&&200==e.resultStatusCode&&e.resultResponseObject){var t,a=_createForOfIteratorHelper(e.resultResponseObject.payload.shift_codes);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.properties.code.id==m)return r}}catch(e){a.e(e)}finally{a.f()}}return!1}();if(lpbUpdate(85,!0,{start:50}),console.info(d),d){if(d.states.user.canEdit){var t=dom.find.id("shift_code_".concat(m)),a=dom.find.child(t,"class","view edit"),r=dom.find.child(a,"tag","form"),o=((c={}).code_id=m,c.reward=d.info.reward,c.game_id=d.properties.game_id,l=d.info.source,c.source_type=l.type,"online"==l.type?(c.source_url=l.value,c.source_string=""):"physical"==l.type?(c.source_url="",c.source_string=l.value):"none"==l.type&&(c.source_url="",c.source_string="N/A"),function(){var e=d.info.release_date;if("date"==e.type){var t=moment(e.value);if(t)return c.release_date=t.format("Y-MM-DD")}c.release_date=""}(),function(){var e=d.info.expiration_date,t=d.info.timezone;if(c.expiration_date_type=e.type,-1!=["through","until"].indexOf(e.type)){var a=moment.tz(e.value,t);if(a)return c.expiration_date_value_date=a.format("Y-MM-DD"),c.expiration_date_value_time=a.format("HH:mm:SS"),c.expiration_date_value_tz=t}c.expiration_date_value_date="",c.expiration_date_value_time="",c.expiration_date_value_tz=""}(),c.notes=d.info.notes?d.info.notes:"",function(){var e=d.codes.platforms,t=d.codes.shift_codes,a=void 0!==t.universal&&null!==t.universal;c.codes_code_type=a?"universal":"individual",c.codes_universal_platforms=a?e.universal:"",c.codes_universal_code=a?t.universal:"";for(var r=0,o=Object.keys(ShiftCodesTK.shift.platforms);r<o.length;r++){var i=o[r];c["codes_individual_".concat(i,"_platforms")]=a?"":e[i],c["codes_individual_".concat(i,"_code")]=a?"":t[i]}}(),c);for(var i in console.log(o),o){var n=M.getField(r,i),s=o[i];Array.isArray(n)&&(n=n[0]),M.updateField(n,s,{updateDefault:!0})}return M.resetForm(r),multiView_update(a),h(!1),v.toggleLayer(u,!1),lpbUpdate(100),!0}return e("You do not have permission to edit this SHiFT Code. If you had access before, it may have been revoked. Please refresh the page and try again."),!1}return e(),!1}var l,c},100))},["click"]),window.addEventListener("tkFormsFormBeforeReset",function(e){var t,a,r=e.formEventData;-1!=r.form.id.indexOf("update_shift_code_form")&&(t=dom.find.id("shift_code_".concat(r.formData.code_id)),a=dom.find.child(t,"class","view code"),multiView_update(a))}),window.addEventListener("tkFormsFormBeforeSubmitConfirmation",function(e){var t,a=e.formEventData;if("delete_shift_code_form"==a.formProps.info.name){a.formResponseData;e.preventDefault(),lpbUpdate(75,!0);var o=a.formData.code_id,m=function(){var e=g.savedRequests.getResultData("FetchShiftCodes").lastResult;if(e&&200==e.resultStatusCode&&e.resultResponseObject){var t,a=_createForOfIteratorHelper(e.resultResponseObject.payload.shift_codes);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(r.properties.code.id==o)return r}}catch(e){a.e(e)}finally{a.f()}}return!1}();if(m){if(m.states.user.canEdit){var h=a.confirmationModal,r=(t=edit.copy(dom.find.id("delete_shift_code_confirmation_modal_template")),{mode:"update",showModal:!1,title:'Delete SHiFT Code: "'.concat(m.info.reward,'"?'),body:t,id:"form_submit_confirmation_modal",actions:{approve:{name:"Delete SHiFT Code",tooltip:"Permanently delete this SHiFT Code. This action is irreversable",color:"danger"}}}),h=i.addConfirmationModal(r);return function(){var e,t,a,r,o="MMMM DD, YYYY hh:mm A [UTC]",i={id:{primary:m.properties.code.id,secondary:"SHiFT Code #"},owner:{primary:m.properties.owner.username,secondary:"#".concat(m.properties.owner.id)},created:(a=m.info.creation_date,r=moment(a),{primary:ucWords(r.fromNow()),secondary:r.format(o)}),updated:(e=m.info.last_update,t=moment(e),{primary:ucWords(t.fromNow()),secondary:t.format(o)})},d=dom.find.child(h,"class","info");for(var n in i){var s=i[n],l=dom.find.child(d,"class","section ".concat(n)),c=dom.find.child(l,"tag","dd");for(var f in s){var u=dom.find.child(c,"class",f),p=s[f];u.innerHTML=p,-1!=["","N/A"].indexOf(p)&&edit.class(u,"add","inactive"),"secondary"==f&&-1!=["created","expiration"].indexOf(n)&&edit.attr(u,"update","aria-label","(".concat(p,")"))}}}(),dropdownPanelSetup(dom.find.child(h,"class","dropdown-panel")),edit.attr(h,"add","data-code-id",o),i.toggleModal(h,!0),!0}return editCodeError("You do not have permission to delete this SHiFT Code. If you had access before, it may have been revoked. Please refresh the page and try again."),!1}return function(e){var t=0<arguments.length&&void 0!==e?e:"This SHiFT Code could not be deleted due to an error. Please try again later.";lpbUpdate(100),y.newToast({settings:{duration:"long",template:"fatalException"},content:{title:"Could not delete SHiFT Code",body:t}})}(),!1}}))},250)}();