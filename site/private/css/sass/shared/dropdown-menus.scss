@import "../partials/_globals";

.dropdown-menu-container {
  @include ready;
  @include fill;

  .dropdown-menu {
    display: grid;
  }
}
.dropdown-menu {
  $borderWidth: 1.5px;
  $borderRadius: 8px;

  display: none; // Hide dropdowns that are not inside of the Dropdown Menu Container

  position: absolute;
  font-size: 1rem;
  cursor: pointer;
  z-index: zOrder(dropdownMenuPanel);
  transition: opacity 0.2s ease-in-out;

  @mixin menuRoot {
    @at-root .dropdown-menu { @content; }
  }

  &[hidden] {
    opacity: 0;
  }
  &.sticky {
    position: fixed;
  }

  .arrow {
    display: none;
    position: absolute;
    @include multiProp(0, sizing);
    border: bd(0.75em, transparent);
    border-bottom-color: #fff;

    @mixin pos($translation, $rotation) {
      transform: translate($translation) rotate($rotation);
    }

    // Positioning
    & {
      $posList: (
        bottom: (0 -1em, 0deg),
        top: (0 1em, 180deg),
        right: (-1em 0, 270deg),
        left: (1em 0, 90deg)
        );

      @include menuRoot {
        @each $posN, $posL in $posList {
          &[data-pos="#{$posN}"] .arrow {
            transform: translate(nth($posL, 1)) rotate(nth($posL, 2));

            @if $posN == bottom or $posN == top      { justify-self: center; }
            @else if $posN == right or $posN == left { align-self: center; }
          }
        }
      }
    }
  }
  .panel {
    position: absolute;
    @include colors(#fff, $site-color-light);
    border: bd($borderWidth, #fff);
    border-radius: $borderRadius;
    box-shadow: shadow(tpb(0.5));
    
    // Positioning
    & {
      $posList: (
        bottom: 0 0.5em,
        top: 0 -0.5em,
        right: 0.5em 0,
        left: -0.5em 0
        );
      @mixin declarations ($alignments, $property, $min) {
        $pos: unquote('');
        $neg: unquote('');

        @each $alignN, $alignV in $alignments {
          $selector: '[data-align="#{$alignN}"]';
          $pos: #{$pos}#{'&'}#{$selector}#{' .panel, '};
          $neg: #{$neg}#{':not('}#{$selector}#{')'};

          &#{unquote($selector)} .panel { #{$property}: $alignV; }
        }
        #{unquote($pos)}         { min-#{$min}: calc(50% + 1em); }
        &#{unquote($neg)} .panel { #{$property}: center; }
      }

      @include menuRoot {
        @each $posN, $posV in $posList {
          &[data-pos="#{$posN}"] .panel { transform: translate($posV); }
        }
        &[data-pos="top"], &[data-pos="bottom"] {
          $alignmentList: (
            left: flex-start,
            right: flex-end
            );

          @include declarations($alignmentList, justify-self, width);
        }
        &[data-pos="left"], &[data-pos="right"] {
          $alignmentList: (
            top: flex-start,
            bottom: flex-end
            );

          @include declarations($alignmentList, align-self, height);
        }
      }
    }
    .title {
      opacity: 0.5;
      font-size: 1.2em;
      border-radius: $borderRadius $borderRadius 0 0;
      cursor: default;
    }
    .choice-list {
      &.scrollable {
        max-height: 12.5em;
        overflow-x: hidden;
        overflow-y: scroll;
      }

      li {
        margin: 8px;
      }
      .separator {
        border-bottom: bd(tpw(0.25));
        margin: 12px 16px;
        border-radius: 4px;
      }
    }
    .choice {
      @include flexbox(c, s);
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 4px;

      &.styled, &.button {
        &::after {
          border: none;
        }
      }

      &[hidden] {
        display: none;
      }

      &:not(.styled):not(.button) {
        &::before {
          @include fill(true);
        }
  
        &[aria-pressed="false"], &:not([aria-pressed]) {
          color: inherit;
  
          &::before { 
            background-color: tpw(0.75); 
          }

          @include mouseState(noHover) {
            &::before                          { opacity: 0; }
            &::after                           { opacity: 0.5; }

            > span                             { opacity: 0.75; }
          }
          @include mouseState(hover) {
            &::before                          { opacity: 0.35 }
            &::after                           { opacity: 0.75; }
            
            > span                             { opacity: 1; }
          }
          @include mouseState(click) {
            &::before                          { opacity: 0.15 }
          }
        }
        &[aria-pressed="true"] {
          color: #fff;
          @include theme(bg);
  
          &::before {
            background-color: #fff;
          }
  
          @include mouseState(noHover) {
            &::before { opacity: 0; }
          }
          @include mouseState(hover) {
            &::before { opacity: 0.25; }
          }
          @include mouseState(click) {
            opacity: 0.75;
          }
        }
      }

      &::after {
        @include fill(true);
      }
    }
    .title, .choice {
      $basePadding: 8px;

      text-align: left;
      width: 100%;
      white-space: nowrap;
      padding: #{$basePadding * 1.75} #{$basePadding * 4} #{$basePadding * 1.75} #{$basePadding * 2};
      min-width: 7.5em;

      &.title {
        padding-bottom: 0;
      }
    }
  }
  .arrow, .panel {
    cursor: default;
    z-index: zOrder(dropdownMenuPanel);
  }
  // Positioning
  & {
    $posList: (
      bottom: top,
      top: bottom,
      right: left,
      left: right
      );

    @each $posN, $posD in $posList {
      @include menuRoot {
        &[data-pos="#{$posN}"] .arrow { #{$posD}: calc(100% + 3.5px + #{$borderWidth}); }
        &[data-pos="#{$posN}"] .panel { #{$posD}: calc(100% + 4px); }
      }
    }
  }
}
.dropdown-menu-toggle {
  &::after {
    @include fill(true);
  }

  &[aria-expanded="true"] {
    z-index: zOrder(dropdownMenuToggle);
  }
}
