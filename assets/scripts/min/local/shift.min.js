var shiftData={};function updateFeedSettings(e,t){var r=document.getElementById("shift_code_feed"),l=document.getElementById("shift_code_cache").getElementsByClassName("shift-code");codes=[];var a,s=0,n=getDate("m-d-y","/");function o(e){var t;r.appendChild(e),s++,updatePanelTiming(t=r.children[s-1],s),addDropdownPanelListener(t),addPanelListeners(t)}if(function(){var e=r.getElementsByClassName("shift-code");for(i=0;i<l.length;i++){var t=l[i],a="true"==t.getAttribute("data-expanded");for(x=0;x<e.length;x++){var s=e[x],n="true"==s.getAttribute("data-expanded");s.id==t.id&&n!=a&&(console.warn("Current Stored State: "+a+" | Updating to: "+!a),updateDropdownPanelAttributes(t,!a))}codes[i]={},codes[i].panel=t.cloneNode(!0),codes[i].relDate=t.getElementsByClassName("section rel")[0].getElementsByClassName("content")[0].innerHTML,codes[i].expDate=t.getElementsByClassName("section exp")[0].getElementsByClassName("content")[0].innerHTML}r.innerHTML=""}(),"filter"==e){r.getAttribute("data-filter");if("none"!=t){function d(e){o(e.panel),e.used=!0}for(var c=0;c<codes.length;c++)"new"==t&&codes[c].relDate==n?d(codes[c]):"exp"==t&&codes[c].expDate==n&&d(codes[c])}else updateFeedSettings("sort",r.getAttribute("data-sort"));r.setAttribute("data-filter",t),function(){var e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button"),t={true:"(Click to remove filter)",false:"(Click to filter)"};for(i=0;i<e.length;i++){var a=e[i].classList[1]==r.getAttribute("data-filter"),s=e[i].title.replace(/\(.*\)/g,t[a]);e[i].setAttribute("data-pressed",a),e[i].setAttribute("aria-pressed",a),updateLabel(e[i],s)}}()}if("sort"==e){function m(s){codes=codes.sort(function(e,t){var a={new:{primary:t,secondary:e},old:{primary:e,secondary:t}};return e.relDate!=t.relDate?a[s].primary.relDate.localeCompare(a[s].secondary.relDate):a[s].primary.expDate.localeCompare(a[s].secondary.expDate)})}if("default"==t){function u(e){!0!==codes[e].used&&(o(codes[e].panel),codes[e].used=!0)}m("new");for(var g=0;g<codes.length;g++)codes[g].expDate==n&&u(g);for(var f=0;f<codes.length;f++)codes[f].relDate==n&&u(f);for(var p=0;p<codes.length;p++)"N/A"!=codes[p].expDate&&u(p);for(var y=0;y<codes.length;y++)u(y)}if("newest"==t){m("new");for(var h=0;h<codes.length;h++)o(codes[h].panel)}if("oldest"==t){m("old");for(var v=0;v<codes.length;v++)o(codes[v].panel)}a=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button"),r.setAttribute("data-sort",t),setTimeout(function(){for(i=0;i<a.length;i++){var e=a[i].getAttribute("data-value")==t;a[i].setAttribute("data-pressed",e),a[i].setAttribute("aria-pressed",e)}},250)}}function updatePanelTiming(e,t){e.style.animationDelay=.2*(t-1)+"s"}function addPanelListeners(e){var t=e.getElementsByClassName("copy");for(i=0;i<t.length;i++)t[i].addEventListener("click",copyToClipboard)}shiftData.base=JSON.parse(document.body.getAttribute("data-shiftData")),shiftData.id=shiftData.base.id,shiftData.name=shiftData.base.name,function(){document.getElementById("shift_header");var f=document.getElementById("shift_code_feed"),p={retrieved:0,total:0,new:0,exp:0};function y(e){p[e]++;var t,a=(t="s",1==p[e]&&(t=""),"SHiFT Code"+t),s=document.getElementById("shift_header_count_"+e),n={total:a+" Available",new:"New "+a,exp:"Expiring "+a},i="total"==e?"":" (Click to filter)";updateLabel(s,p[e]+" "+n[e]+i),s.getElementsByClassName("count")[0].innerHTML=p[e],1==p[e]&&(disenable(s,!1),s.classList.remove("inactive"))}function n(r){var l={};function a(e){return l.body.getElementsByClassName(e)[0].getElementsByClassName("content")[0]}function e(e){var t={};return t.title=l.body.getElementsByClassName(e)[0].getElementsByClassName("title")[0],t.base=a(e),t.value=t.base.getElementsByClassName("value")[0],t.display=t.base.getElementsByClassName("display")[0],t.copy=t.base.getElementsByClassName("copy")[0],t}l.template=document.getElementById("shift_code_template"),l.base=l.template.content.children[0].cloneNode(!0),l.header=l.base.getElementsByClassName("header")[0],l.title=l.header.getElementsByClassName("title")[0].getElementsByClassName("string")[0],l.reward=l.title.getElementsByClassName("reward")[0],l.labels={},l.labels.description=l.title.getElementsByClassName("label description")[0],l.labels.new=l.base.getElementsByClassName("label new")[0],l.labels.exp=l.base.getElementsByClassName("label exp")[0],l.progress=l.header.getElementsByClassName("progress-bar")[0],l.progressBar=l.progress.getElementsByClassName("progress")[0],l.body=l.base.getElementsByClassName("body")[0],l.relDate=a("rel"),l.expDate=a("exp"),l.source=a("src").getElementsByTagName("a")[0],l.notes=a("notes").getElementsByTagName("ul")[0],l.codePC=e("pc"),l.codeXbox=e("xbox"),l.codePS=e("ps");var t,s,n,o,d,c,m,u=getDate();function g(e){var t=e.substring(0,4);return(e.substring(5)+"/"+t).replace(/-/g,"/")}l.base.id="shift_code_"+r.codeID,t=r.reward,s=l.labels.description,"5 Golden Keys"!=t&&(l.reward.innerHTML=t,updateLabel(s,"Rare SHiFT Code"),s.childNodes[0].innerHTML="Rare SHiFT Code"),o=getDate("m-d-y","/"),d=g(r.relDate),c=null===(n=r.expDate)?(l.expDate.classList.add("inactive"),"N/A"):g(n),l.relDate.innerHTML=d,l.expDate.innerHTML=c,o==d?l.base.classList.add("new"):l.labels.new.remove(),o==c?l.base.classList.add("exp"):l.labels.exp.remove(),function(){function t(e,t){var a={start:new Date(e),end:new Date(t)},s=Math.abs(a.end.getTime()-a.start.getTime());return Math.ceil(s/864e5)}function e(e,t){updateLabel(l.progress,e),l.progress.setAttribute("aria-valuenow",t),l.progressBar.style.width=t+"%"}if("N/A"!=c){var a=function(){if(d==c)return 100;var e=(t(o,d)/t(c,d)*100).toString();return-1!=e.indexOf(".")?e.match(/\d{1,2}(?=\.)/)[0]:e}();e((n=t(o,c),s="",1!=n&&(s="s"),n+" Day"+s+" Left"),a)}else e("No Expiration Date",0),l.progress.classList.add("inactive");var s,n}(),function(){var e,t=r.source;if(null!==t){var a=(e="Source",-1!=t.indexOf("facebook")?e+=" (Facebook)":-1!=t.indexOf("twitter")&&(e+=" (Twitter)"),e);l.source.href=t,l.source.innerHTML+=t,updateLabel(l.source,a)}else{var s=document.createElement("span"),n=l.source.parentNode;s.innerHTML="N/A",updateLabel(s,"No confirmed source available"),n.appendChild(s),n.classList.add("inactive"),l.source.remove()}}(),null!==(m=r.notes)?l.notes.innerHTML=-1==m.indexOf("-")?"<li><i>"+m+"</i></li>":m.replace(/-.*/g,function(e){return e.replace(/-\s{1}/g,"<li><i>")+"</i></li>"}):l.notes.parentNode.parentNode.remove(),function(){var e=["PC","Xbox","PS"];for(i=0;i<e.length;i++){var t="code"+e[i],a=l[t],s=r[t];a.title.innerHTML=r["platforms"+e[i]]+":",a.display.innerHTML=s,a.value.value=s}}(),dropdownPanelSetup(l.base),addPanelListeners(l.base),function(){var e=document.getElementById("shift_overlay");if(y("total"),updatePanelTiming(l.base,p.total),f.appendChild(l.base),r.relDate==u?y("new"):r.expDate==u&&y("exp"),1==p.total&&vishidden(e,!0),p.total==p.retrieved)for(addFocusScrollListeners(f),disenable(document.getElementById("shift_header_sort"),!1),e.remove(),document.getElementById("shift_code_template").remove(),i=0;i<f.children.length;i++){var t=f.children[i].cloneNode(!0);document.getElementById("shift_code_cache").appendChild(t)}}()}!function e(){"function"==typeof newAjaxRequest&&"function"==typeof getDate?newAjaxRequest({file:"/assets/php/scripts/shift/retrieveCodes.php?gameID=".concat(shiftData.id),callback:function(e){var t=JSON.parse(e).response;if(p.retrieved=t.length,0<p.retrieved)for(var a=0;a<p.retrieved;a++)n(t[a]);else{var s=document.getElementById("shift_overlay");vishidden(s.getElementsByClassName("spinner")[0],!0),vishidden(s.getElementsByClassName("error")[0],!1)}}}):setTimeout(function(){e()},100)}()}(),function(){var e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){var t=this.classList[1];t!=document.getElementById("shift_code_feed").getAttribute("data-filter")?updateFeedSettings("filter",t):updateFeedSettings("filter","none")})}(),function(){var a=document.getElementById("shift_header_sort_dropdown"),e=a.getElementsByTagName("BUTTON");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){var t=this.getAttribute("data-value");t!=document.getElementById("shift_code_feed").getAttribute("data-sort")&&updateFeedSettings("sort",t),toggleDropdownMenu(a)})}();