let shiftData={};function toggleSortDropdown(){let e=document.getElementById("shift_header_sort"),t=document.getElementById("shift_header_sort_dropdown"),n=t.getElementsByTagName("button"),a="true"==t.getAttribute("data-expanded");function s(){t.setAttribute("data-expanded",!a),t.setAttribute("aria-expanded",!a)}for(e.setAttribute("data-pressed",!a),e.setAttribute("data-pressed",!a),i=0;i<n.length;i++)disenable(n[i],a);!1===a?(vishidden(t,!1),window.addEventListener("click",checkSortDropdownClick),window.addEventListener("keydown",checkSortDropdownKey),setTimeout(function(){let e=t.getElementsByTagName("button");for(s(),i=0;i<e.length;i++)"true"==e[i].getAttribute("data-pressed")&&e[i].focus()},50)):(s(),window.removeEventListener("click",checkSortDropdownClick),window.removeEventListener("keydown",checkSortDropdownKey),setTimeout(function(){vishidden(t,!0),e.focus()},250))}function toggleFilterOverlay(e,t){let n=e.classList.contains("filter-overlay")?e:e.parentNode.parentNode,a=n.getAttribute("data-visible");function s(){n.setAttribute("data-visible",t)}"hover-show"==t||"button-show"==t&&"hover-show"!=a?(vishidden(n,!1),setTimeout(s,50)):("hover-hide"==t||"button-hide"==t&&"hover-show"!=a)&&(n.setAttribute("data-visible",t),setTimeout(s,250))}function updateFeedSettings(e,t){let n=document.getElementById("panel_feed"),a=document.getElementById("panel_feed_template").getElementsByClassName("panel"),s=[],l=0,o=getDate("m-d-y");function r(e){n.appendChild(e),l++,updatePanelTiming(n.children[l-1],l),addPanelListeners(n.children[l-1])}if(function(){for(i=0;i<a.length;i++)s[i]={},s[i].panel=a[i].cloneNode(!0),s[i].relDate=a[i].getElementsByClassName("section rel")[0].getElementsByClassName("content")[0].innerHTML,s[i].expDate=a[i].getElementsByClassName("section exp")[0].getElementsByClassName("content")[0].innerHTML;n.innerHTML=""}(),"filter"==e){n.getAttribute("data-filter");if("none"!=t){function d(e){r(e.panel),e.used=!0}for(let e=0;e<s.length;e++)"new"==t&&s[e].relDate==o?d(s[e]):"exp"==t&&s[e].expDate==o&&d(s[e]);for(let e=0;e<s.length;e++)if(!0!==s[e].used){let t={buttons:s[e].panel.getElementsByTagName("button"),links:s[e].panel.getElementsByTagName("a")};for(x=0;x<t.buttons.length;x++)disenable(t.buttons[x],!0);for(x=0;x<t.links.length;x++)disenable(t.links[x],!0);!function(){let t,n=document.getElementById("panel_filter_overlay_template").content.children[0].cloneNode(!0);s[e].panel.setAttribute("data-filtered","true"),s[e].panel.appendChild(n),t=(n=s[e].panel.getElementsByClassName("filter-overlay")[0]).getElementsByClassName("clear")[0],n.addEventListener("mouseenter",function(e){toggleFilterOverlay(this,"hover-show")}),n.addEventListener("mouseleave",function(e){toggleFilterOverlay(this,"hover-hide")}),t.addEventListener("focus",function(e){toggleFilterOverlay(this,"button-show")}),t.addEventListener("blur",function(e){toggleFilterOverlay(this,"button-hide")}),t.addEventListener("click",function(e){updateFeedSettings("filter","none")})}(),d(s[e])}}else updateFeedSettings("sort",n.getAttribute("data-sort"));n.setAttribute("data-filter",t),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button"),t={true:"(Click to remove filter)",false:"(Click to filter)"};for(i=0;i<e.length;i++){let a=e[i].classList[1]==n.getAttribute("data-filter"),s=e[i].title.replace(/\(.*\)/g,t[a]);e[i].setAttribute("data-pressed",a),e[i].setAttribute("aria-pressed",a),e[i].title=s,e[i].setAttribute("aria-label",s)}}()}if("sort"==e){function c(e){s=s.sort(function(t,n){let a={new:{primary:n,secondary:t},old:{primary:t,secondary:n}};return t.relDate!=n.relDate?a[e].primary.relDate.localeCompare(a[e].secondary.relDate):a[e].primary.expDate.localeCompare(a[e].secondary.expDate)})}if("default"==t){function d(e){!0!==s[e].used&&(r(s[e].panel),s[e].used=!0)}c("new");for(let e=0;e<s.length;e++)s[e].expDate==o&&d(e);for(let e=0;e<s.length;e++)s[e].relDate==o&&d(e);for(let e=0;e<s.length;e++)"N/A"!=s[e].expDate&&d(e);for(let e=0;e<s.length;e++)d(e)}if("newest"==t){c("new");for(let e=0;e<s.length;e++)r(s[e].panel)}if("oldest"==t){c("old");for(let e=0;e<s.length;e++)r(s[e].panel)}!function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button");n.setAttribute("data-sort",t),setTimeout(function(){for(i=0;i<e.length;i++){let n=e[i].getAttribute("data-value")==t;e[i].setAttribute("data-pressed",n),e[i].setAttribute("aria-pressed",n)}},250)}()}}function checkSortDropdownClick(e){let t=document.getElementById("shift_header_sort_dropdown").getElementsByClassName("panel")[0],n=[e,e.target.parentNode,e.target.parentNode.parentNode,e.target.parentNode.parentNode.parentNode],a=!1;for(i=0;i<n.length;i++)if(n[i]==t){a=!0;break}!1===a&&toggleSortDropdown()}function checkSortDropdownKey(e){let t=e.target,n=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button"),a=n[0],s=n[n.length-1];(!0===e.shiftKey&&"Tab"==e.key&&t==a||!1===e.shiftKey&&"Tab"==e.key&&t==s)&&(e.preventDefault(),t==a?s.focus():t==s&&a.focus())}function togglePanel(e){let t=e.currentTarget.parentNode.parentNode.parentNode,n={};n.body=t.getElementsByClassName("body")[0],n.body.link=n.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].getElementsByTagName("a")[0],n.body.copyPC=n.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyXbox=n.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyPS=n.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0];let a="true"==t.getAttribute("data-expanded"),s={true:"Collapse SHiFT Code",false:"Expand SHiFT Code"};t.setAttribute("data-expanded",!a),t.setAttribute("aria-expanded",!a),e.currentTarget.title=s[!a],e.currentTarget.setAttribute("aria-label",s[!a])}function copyCode(e){e.parentNode.getElementsByClassName("value")[0].select(),document.execCommand("copy"),e.classList.remove("animated"),setTimeout(function(){e.classList.add("animated")},1)}function updatePanelTiming(e,t){e.style.animationDelay=.2*(t-1)+"s"}function addPanelListeners(e){let t=e.getElementsByClassName("toggle")[0],n=e.getElementsByClassName("copy");for(t.addEventListener("click",togglePanel),i=0;i<n.length;i++)n[i].addEventListener("click",function(e){copyCode(this)})}shiftData.base=JSON.parse(document.body.getAttribute("data-shiftData")),shiftData.id=shiftData.base.id,shiftData.name=shiftData.base.name,function(){document.getElementById("shift_header");let e=document.getElementById("panel_feed"),t={retrieved:0,total:0,new:0,exp:0};function n(e){t[e]++;let n=function(){let n="s";return 1==t[e]&&(n=""),"SHiFT Code"+n}(),a=document.getElementById("shift_header_count_"+e),s={total:n+" Available",new:"New "+n,exp:"Expiring "+n},l="total"==e?"":" (Click to filter)",i=t[e]+" "+s[e]+l;a.title=i,a.setAttribute("aria-label",i),a.getElementsByClassName("count")[0].innerHTML=t[e],1==t[e]&&(disenable(a,!1),a.classList.remove("inactive"))}function a(a){let s={};s.base=document.getElementById("panel_template").content.children[0].cloneNode(!0),s.flags={},s.flags.new=s.base.getElementsByClassName("flag new")[0],s.flags.exp=s.base.getElementsByClassName("flag exp")[0],s.header=s.base.getElementsByClassName("header")[0],s.title=s.header.getElementsByClassName("top")[0].getElementsByClassName("title")[0],s.reward=s.title.getElementsByClassName("reward")[0],s.description=s.title.getElementsByClassName("description")[0],s.progress=s.header.getElementsByClassName("bottom")[0].getElementsByClassName("progress-bar")[0],s.progressBar=s.progress.getElementsByClassName("progress")[0],s.body=s.base.getElementsByClassName("body")[0],s.relDate=s.body.getElementsByClassName("rel")[0].getElementsByClassName("content")[0],s.expDate=s.body.getElementsByClassName("exp")[0].getElementsByClassName("content")[0],s.source=s.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].firstChild,s.notes=s.body.getElementsByClassName("notes")[0].getElementsByClassName("content")[0],s.codePC={},s.codePC.title=s.body.getElementsByClassName("pc")[0].getElementsByClassName("title")[0],s.codePC.base=s.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0],s.codePC.display=s.codePC.base.getElementsByClassName("display")[0],s.codePC.value=s.codePC.base.getElementsByClassName("value")[0],s.codePC.copy=s.codePC.base.getElementsByClassName("copy")[0],s.codeXbox={},s.codeXbox.title=s.body.getElementsByClassName("xbox")[0].getElementsByClassName("title")[0],s.codeXbox.base=s.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0],s.codeXbox.display=s.codeXbox.base.getElementsByClassName("display")[0],s.codeXbox.value=s.codeXbox.base.getElementsByClassName("value")[0],s.codeXbox.copy=s.codeXbox.base.getElementsByClassName("copy")[0],s.codePS={},s.codePS.title=s.body.getElementsByClassName("ps")[0].getElementsByClassName("title")[0],s.codePS.base=s.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0],s.codePS.display=s.codePS.base.getElementsByClassName("display")[0],s.codePS.value=s.codePS.base.getElementsByClassName("value")[0],s.codePS.copy=s.codePS.base.getElementsByClassName("copy")[0];let l=getDate();s.base.id="shift_code_"+a.codeID,function(){let e=a.reward;s.reward.innerHTML=e,e.length>20&&s.description.classList.add("long"),"5 Golden Keys"!=e&&(s.description.innerHTML="Rare SHiFT Code")}(),function(){function e(e){let t=e.substring(0,4);return(e.substring(5)+"/"+t).replace(/-/g,"/")}let t=getDate("m-d-y","/"),n=e(a.relDate),l=function(){let t=a.expDate;return null===t?(s.expDate.classList.add("inactive"),"N/A"):e(t)}();s.relDate.innerHTML=n,s.expDate.innerHTML=l,t==n?s.base.classList.add("new"):s.flags.new.remove(),t==l?s.base.classList.add("exp"):s.flags.exp.remove(),function(){function e(e,t){let n={start:new Date(e),end:new Date(t)},a=Math.abs(n.end.getTime()-n.start.getTime());return Math.ceil(a/864e5)}function a(e,t){s.progress.title=e,s.progress.setAttribute("aria-label",e),s.progress.setAttribute("aria-valuenow",t),s.progressBar.style.width=t+"%"}if("N/A"!=l){let s=function(){let a=(e(t,n)/e(l,n)*100).toString();return-1!=a.indexOf(".")?a.match(/\d{1,2}(?=\.)/)[0]:a}();a(function(){let n=e(t,l),a=function(){let e="";return 1!=n&&(e="s")," Day"+e+" Left"}();return n+a}(),s)}else a("No Expiration Date",0),s.progress.classList.add("inactive")}()}(),function(){let e=a.source,t=function(){let t="Source";return-1!=e.indexOf("facebook")?t+=" (Facebook)":-1!=e.indexOf("twitter")&&(t+=" (Twitter)"),t}();s.source.href=e,s.source.title=t,s.source.setAttribute("aria-label",t),s.source.getElementsByClassName("text")[0].innerHTML=e}(),function(){let e=a.notes;null!==e&&(s.base.setAttribute("data-extraInfo",!0),s.notes.parentNode.classList.remove("inactive"),s.notes.innerHTML=-1==e.indexOf("-")?"<li><i>"+e+"</i></li>":e.replace(/-.*/g,function(e){return e.replace(/-\s{1}/g,"<li><i>")+"</i></li>"}))}(),function(){let e=["PC","Xbox","PS"];for(i=0;i<e.length;i++){let t=s["code"+e[i]],n=a["code"+e[i]];t.title.innerHTML=a["platforms"+e[i]]+":",t.display.innerHTML=n,t.value.value=n}}(),addPanelListeners(s.base),function(){let o=document.getElementById("shift_overlay");if(e.appendChild(s.base),n("total"),updatePanelTiming(s.base,t.total),a.relDate==l?n("new"):a.expDate==l&&n("exp"),1==t.total&&vishidden(o,!0),t.total==t.retrieved)for(addFocusScrollListeners(e),disenable(document.getElementById("shift_header_sort"),!1),o.remove(),document.getElementById("panel_template").remove(),i=0;i<e.children.length;i++){let t=e.children[i].cloneNode(!0);document.getElementById("panel_feed_template").appendChild(t)}}()}!function(){!function e(){"function"==typeof newAjaxRequest&&"function"==typeof getDate?newAjaxRequest("GET","assets/php/scripts/shift/retrieveCodes.php?gameID="+shiftData.id,function(e){let n=JSON.parse(e).response;if(t.retrieved=n.length,t.retrieved>0)for(let e=0;e<t.retrieved;e++)a(n[e]);else{let e=document.getElementById("shift_overlay");vishidden(e.getElementsByClassName("spinner")[0],!0),vishidden(e.getElementsByClassName("error")[0],!1)}}):setTimeout(function(){e()},100)}()}()}(),document.getElementById("shift_header_sort").addEventListener("click",toggleSortDropdown),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.classList[1];t!=document.getElementById("panel_feed").getAttribute("data-filter")?updateFeedSettings("filter",t):updateFeedSettings("filter","none")})}(),function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("BUTTON");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.getAttribute("data-value");t!=document.getElementById("panel_feed").getAttribute("data-filter")&&updateFeedSettings("sort",t),toggleSortDropdown()})}();