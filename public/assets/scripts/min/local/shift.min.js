let shiftData={};function toggleSortDropdown(){let e=document.getElementById("shift_header_sort"),t=document.getElementById("shift_header_sort_dropdown"),n=t.getElementsByTagName("button"),a="true"==t.getAttribute("data-expanded");function s(){t.setAttribute("data-expanded",!a),t.setAttribute("aria-expanded",!a)}for(e.setAttribute("data-pressed",!a),e.setAttribute("data-pressed",!a),i=0;i<n.length;i++)disenable(n[i],a);!1===a?(vishidden(t,!1),window.addEventListener("click",checkSortDropdownClick),window.addEventListener("keydown",checkSortDropdownKey),setTimeout(function(){let e=t.getElementsByTagName("button");for(s(),i=0;i<e.length;i++)"true"==e[i].getAttribute("data-pressed")&&e[i].focus()},50)):(s(),window.removeEventListener("click",checkSortDropdownClick),window.removeEventListener("keydown",checkSortDropdownKey),setTimeout(function(){vishidden(t,!0),e.focus()},250))}function updateFeedSettings(e,t){let n=document.getElementById("shift_code_feed"),a=document.getElementById("shift_code_cache").getElementsByClassName("shift-code");codes=[];let s=0,o=getDate("m-d-y","/");function l(e){let t;n.appendChild(e),s++,updatePanelTiming(t=n.children[s-1],s),addDropdownPanelListener(t),addPanelListeners(t)}if(function(){let e=n.getElementsByClassName("shift-code");for(i=0;i<a.length;i++){let t=a[i],n="true"==t.getAttribute("data-expanded");for(x=0;x<e.length;x++){let a=e[x],s="true"==a.getAttribute("data-expanded");a.id==t.id&&s!=n&&(console.warn("Current Stored State: "+n+" | Updating to: "+!n),updateDropdownPanelAttributes(t,!n))}codes[i]={},codes[i].panel=t.cloneNode(!0),codes[i].relDate=t.getElementsByClassName("section rel")[0].getElementsByClassName("content")[0].innerHTML,codes[i].expDate=t.getElementsByClassName("section exp")[0].getElementsByClassName("content")[0].innerHTML}n.innerHTML=""}(),"filter"==e){n.getAttribute("data-filter");if("none"!=t){function d(e){l(e.panel),e.used=!0}for(let e=0;e<codes.length;e++)"new"==t&&codes[e].relDate==o?d(codes[e]):"exp"==t&&codes[e].expDate==o&&d(codes[e])}else updateFeedSettings("sort",n.getAttribute("data-sort"));n.setAttribute("data-filter",t),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button"),t={true:"(Click to remove filter)",false:"(Click to filter)"};for(i=0;i<e.length;i++){let a=e[i].classList[1]==n.getAttribute("data-filter"),s=e[i].title.replace(/\(.*\)/g,t[a]);e[i].setAttribute("data-pressed",a),e[i].setAttribute("aria-pressed",a),updateLabel(e[i],s)}}()}if("sort"==e){function r(e){codes=codes.sort(function(t,n){let a={new:{primary:n,secondary:t},old:{primary:t,secondary:n}};return t.relDate!=n.relDate?a[e].primary.relDate.localeCompare(a[e].secondary.relDate):a[e].primary.expDate.localeCompare(a[e].secondary.expDate)})}if("default"==t){function d(e){!0!==codes[e].used&&(l(codes[e].panel),codes[e].used=!0)}r("new");for(let e=0;e<codes.length;e++)codes[e].expDate==o&&d(e);for(let e=0;e<codes.length;e++)codes[e].relDate==o&&d(e);for(let e=0;e<codes.length;e++)"N/A"!=codes[e].expDate&&d(e);for(let e=0;e<codes.length;e++)d(e)}if("newest"==t){r("new");for(let e=0;e<codes.length;e++)l(codes[e].panel)}if("oldest"==t){r("old");for(let e=0;e<codes.length;e++)l(codes[e].panel)}!function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button");n.setAttribute("data-sort",t),setTimeout(function(){for(i=0;i<e.length;i++){let n=e[i].getAttribute("data-value")==t;e[i].setAttribute("data-pressed",n),e[i].setAttribute("aria-pressed",n)}},250)}()}}function checkSortDropdownClick(e){let t=document.getElementById("shift_header_sort_dropdown").getElementsByClassName("panel")[0],n=[e,e.target.parentNode,e.target.parentNode.parentNode,e.target.parentNode.parentNode.parentNode],a=!1;for(i=0;i<n.length;i++)if(n[i]==t){a=!0;break}!1===a&&toggleSortDropdown()}function checkSortDropdownKey(e){let t=e.target,n=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button"),a=n[0],s=n[n.length-1];(!0===e.shiftKey&&"Tab"==e.key&&t==a||!1===e.shiftKey&&"Tab"==e.key&&t==s)&&(e.preventDefault(),t==a?s.focus():t==s&&a.focus())}function togglePanel(e){let t=e.currentTarget.parentNode.parentNode.parentNode,n={};n.body=t.getElementsByClassName("body")[0],n.body.link=n.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].getElementsByTagName("a")[0],n.body.copyPC=n.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyXbox=n.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyPS=n.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0];let a="true"==t.getAttribute("data-expanded");t.setAttribute("data-expanded",!a),t.setAttribute("aria-expanded",!a),updateLabel(e.currentTarget,{true:"Collapse SHiFT Code",false:"Expand SHiFT Code"}[!a])}function copyCode(e){e.parentNode.getElementsByClassName("value")[0].select(),document.execCommand("copy"),e.classList.remove("animated"),setTimeout(function(){e.classList.add("animated")},1)}function updatePanelTiming(e,t){e.style.animationDelay=.2*(t-1)+"s"}function addPanelListeners(e){let t=e.getElementsByClassName("copy");for(i=0;i<t.length;i++)t[i].addEventListener("click",function(e){copyCode(this)})}shiftData.base=JSON.parse(document.body.getAttribute("data-shiftData")),shiftData.id=shiftData.base.id,shiftData.name=shiftData.base.name,function(){document.getElementById("shift_header");let e=document.getElementById("shift_code_feed"),t={retrieved:0,total:0,new:0,exp:0};function n(e){t[e]++;let n=function(){let n="s";return 1==t[e]&&(n=""),"SHiFT Code"+n}(),a=document.getElementById("shift_header_count_"+e),s={total:n+" Available",new:"New "+n,exp:"Expiring "+n},o="total"==e?"":" (Click to filter)";updateLabel(a,t[e]+" "+s[e]+o),a.getElementsByClassName("count")[0].innerHTML=t[e],1==t[e]&&(disenable(a,!1),a.classList.remove("inactive"))}function a(a){let s={};!function(){function e(e){return s.body.getElementsByClassName(e)[0].getElementsByClassName("content")[0]}function t(t){let n={};return n.title=s.body.getElementsByClassName(t)[0].getElementsByClassName("title")[0],n.base=e(t),n.value=n.base.getElementsByClassName("value")[0],n.display=n.base.getElementsByClassName("display")[0],n.copy=n.base.getElementsByClassName("copy")[0],n}s.template=document.getElementById("shift_code_template"),s.base=s.template.content.children[0].cloneNode(!0),s.header=s.base.getElementsByClassName("header")[0],s.title=s.header.getElementsByClassName("title")[0].getElementsByClassName("string")[0],s.reward=s.title.getElementsByClassName("reward")[0],s.labels={},s.labels.description=s.title.getElementsByClassName("label description")[0],s.labels.new=s.base.getElementsByClassName("label new")[0],s.labels.exp=s.base.getElementsByClassName("label exp")[0],s.progress=s.header.getElementsByClassName("progress-bar")[0],s.progressBar=s.progress.getElementsByClassName("progress")[0],s.body=s.base.getElementsByClassName("body")[0],s.relDate=e("rel"),s.expDate=e("exp"),s.source=e("src").getElementsByTagName("a")[0],s.notes=e("notes").getElementsByTagName("ul")[0],s.codePC=t("pc"),s.codeXbox=t("xbox"),s.codePS=t("ps")}();let o=getDate();s.base.id="shift_code_"+a.codeID,function(){let e=a.reward;"5 Golden Keys"!=e&&(s.reward.innerHTML=e,updateLabel(s.labels.description,"Rare SHiFT Code"),s.labels.description.innerHTML="Rare SHiFT Code")}(),function(){function e(e){let t=e.substring(0,4);return(e.substring(5)+"/"+t).replace(/-/g,"/")}let t=getDate("m-d-y","/"),n=e(a.relDate),o=function(){let t=a.expDate;return null===t?(s.expDate.classList.add("inactive"),"N/A"):e(t)}();s.relDate.innerHTML=n,s.expDate.innerHTML=o,t==n?s.base.classList.add("new"):s.labels.new.remove(),t==o?s.base.classList.add("exp"):s.labels.exp.remove(),function(){function e(e,t){let n={start:new Date(e),end:new Date(t)},a=Math.abs(n.end.getTime()-n.start.getTime());return Math.ceil(a/864e5)}function a(e,t){updateLabel(s.progress,e),s.progress.setAttribute("aria-valuenow",t),s.progressBar.style.width=t+"%"}if("N/A"!=o){let s=function(){if(n!=o){let a=(e(t,n)/e(o,n)*100).toString();return-1!=a.indexOf(".")?a.match(/\d{1,2}(?=\.)/)[0]:a}return 100}();a(function(){let n=e(t,o),a=function(){let e="";return 1!=n&&(e="s")," Day"+e+" Left"}();return n+a}(),s)}else a("No Expiration Date",0),s.progress.classList.add("inactive")}()}(),function(){let e=a.source;if(null!==e){let t=function(){let t="Source";return-1!=e.indexOf("facebook")?t+=" (Facebook)":-1!=e.indexOf("twitter")&&(t+=" (Twitter)"),t}();s.source.href=e,s.source.innerHTML+=e,updateLabel(s.source,t)}else{let e=document.createElement("span"),t=s.source.parentNode;e.innerHTML="N/A",updateLabel(e,"No confirmed source available"),t.appendChild(e),t.classList.add("inactive"),s.source.remove()}}(),function(){let e=a.notes;null!==e?s.notes.innerHTML=-1==e.indexOf("-")?"<li><i>"+e+"</i></li>":e.replace(/-.*/g,function(e){return e.replace(/-\s{1}/g,"<li><i>")+"</i></li>"}):s.notes.parentNode.parentNode.remove()}(),function(){let e=["PC","Xbox","PS"];for(i=0;i<e.length;i++){let t="code"+e[i],n=s[t],o=a[t];n.title.innerHTML=a["platforms"+e[i]]+":",n.display.innerHTML=o,n.value.value=o}}(),dropdownPanelSetup(s.base),addPanelListeners(s.base),function(){let l=document.getElementById("shift_overlay");if(n("total"),updatePanelTiming(s.base,t.total),e.appendChild(s.base),a.relDate==o?n("new"):a.expDate==o&&n("exp"),1==t.total&&vishidden(l,!0),t.total==t.retrieved)for(addFocusScrollListeners(e),disenable(document.getElementById("shift_header_sort"),!1),l.remove(),document.getElementById("shift_code_template").remove(),i=0;i<e.children.length;i++){let t=e.children[i].cloneNode(!0);document.getElementById("shift_code_cache").appendChild(t)}}()}!function(){!function e(){"function"==typeof newAjaxRequest&&"function"==typeof getDate?newAjaxRequest("GET","assets/php/scripts/shift/retrieveCodes.php?gameID="+shiftData.id,function(e){let n=JSON.parse(e).response;if(t.retrieved=n.length,t.retrieved>0)for(let e=0;e<t.retrieved;e++)a(n[e]);else{let e=document.getElementById("shift_overlay");vishidden(e.getElementsByClassName("spinner")[0],!0),vishidden(e.getElementsByClassName("error")[0],!1)}}):setTimeout(function(){e()},100)}()}()}(),document.getElementById("shift_header_sort").addEventListener("click",toggleSortDropdown),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.classList[1];t!=document.getElementById("shift_code_feed").getAttribute("data-filter")?updateFeedSettings("filter",t):updateFeedSettings("filter","none")})}(),function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("BUTTON");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.getAttribute("data-value");t!=document.getElementById("shift_code_feed").getAttribute("data-filter")&&updateFeedSettings("sort",t),toggleSortDropdown()})}();