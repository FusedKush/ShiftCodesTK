let shiftData={};function toggleSort(){let e={};e.base=document.getElementById("panel_feed"),e.content=e.base.children,e.count=e.content.length;let t={};t.button=document.getElementById("shift_header_sort"),t.icon=t.button.getElementsByClassName("fas")[0];let s,a={states:{true:"default",false:"flipped"},icons:{true:"fa-sort-amount-down",false:"fa-sort-amount-up"},labels:{true:"Sorted by Newest Codes First. Click to change sort.",false:"Sorted by Oldest Codes First. Click to change sort."}},n="default"==e.base.getAttribute("data-sort"),l=-1,o=[];function r(t){o.push(e.content[t].cloneNode(!0)),e.content[t].remove()}function d(t){e.base.appendChild(o[t]),l++,s="true"==e.content[l].getAttribute("data-expanded"),updatePanelTiming(e.content[l],l+1),updatePanelListeners(e.content[l],"setup-copyOnly"),updatePanelListeners(e.content[l],!1===s?"collapse":"expand")}if(e.base.setAttribute("data-sort",a.states[!n]),t.button.title=a.labels[!n],t.button.setAttribute("aria-label",a.labels[!n]),t.button.classList.remove("animated"),setTimeout(function(){t.button.classList.add("animated"),t.icon.classList.remove(a.icons[n]),t.icon.classList.add(a.icons[!n])},50),"default"==a.states[n]){for(i=0;i<e.count;i++)r(0);for(let e=o.length;e>0;e--)d(e-1)}else{for(i=e.count;i>0;i--)r(i-1);for(let e=0;e<o.length;e++)d(e)}}function togglePanel(e,t){let s="open"==e?t.currentTarget:"close"==e?t.currentTarget.parentNode.parentNode.parentNode:void 0,a={};a.collapse=s.getElementsByClassName("header")[0].getElementsByClassName("top")[0].getElementsByClassName("collapse")[0],a.body=s.getElementsByClassName("body")[0],a.body.link=a.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].getElementsByTagName("a")[0],a.body.copyPC=a.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],a.body.copyXbox=a.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],a.body.copyPS=a.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0];let n="true"==s.getAttribute("data-expanded");"open"==e?(s.removeAttribute("title"),s.removeAttribute("aria-label"),s.removeAttribute("role"),s.removeAttribute("tabindex")):"close"==e&&(s.title="SHiFT Code for "+shiftData.name,s.setAttribute("aria-label","SHiFT Code for "+shiftData.name),s.role="button",s.tabIndex="0"),disenable(a.body.link,n,!0),disenable(a.body.copyPC,n),disenable(a.body.copyXbox,n),disenable(a.body.copyPS,n),disenable(a.collapse,n),vishidden(a.collapse,n),s.setAttribute("data-expanded",!n),s.setAttribute("aria-expanded",!n),"open"==e?(updatePanelListeners(s,"expand"),a.collapse.focus()):"close"==e&&(updatePanelListeners(s,"collapse"),s.focus())}function copyCode(e){e.parentNode.getElementsByClassName("value")[0].select(),document.execCommand("copy"),e.classList.remove("animated"),setTimeout(function(){e.classList.add("animated")},1)}function updatePanelTiming(e,t){e.style.animationDelay=.2*(t-1)+"s"}function updatePanelListeners(e,t){let s=e.getElementsByClassName("collapse")[0],a=e.getElementsByClassName("copy");function n(t){"add"==t?(e.addEventListener("click",shiftEventListenerTogglePanelOpen),e.addEventListener("keydown",shiftEventListenerTogglePanelOpenKey)):"remove"==t&&(e.removeEventListener("click",shiftEventListenerTogglePanelOpen),e.removeEventListener("keydown",shiftEventListenerTogglePanelOpenKey))}function l(e){"add"==e?s.addEventListener("click",shiftEventListenerTogglePanelClose):"remove"==e&&s.removeEventListener("click",shiftEventListenerTogglePanelClose)}function o(){for(i=0;i<a.length;i++)a[i].addEventListener("click",function(e){copyCode(this)})}"setup"==t?(n("add"),o()):"setup-copyOnly"==t?o():"expand"==t?(n("remove"),setTimeout(function(){l("add")},1)):"collapse"==t&&(l("remove"),setTimeout(function(){n("add")},1))}function shiftEventListenerTogglePanelOpen(e){togglePanel("open",e)}function shiftEventListenerTogglePanelOpenKey(e){"Enter"==e.key&&(e.preventDefault(),togglePanel("open",e))}function shiftEventListenerTogglePanelClose(e){togglePanel("close",e)}shiftData.base=JSON.parse(document.body.getAttribute("data-shiftData")),shiftData.id=shiftData.base.id,shiftData.name=shiftData.base.name,function(){let e=shiftData.id,t=shiftData.name,s={};s.base=document.getElementById("panel_template"),s.panel=s.base.content.children[0],s.pcTitle=s.panel.getElementsByClassName("pc")[0].getElementsByClassName("title")[0],s.xboxTitle=s.panel.getElementsByClassName("xbox")[0].getElementsByClassName("title")[0],s.psTitle=s.panel.getElementsByClassName("ps")[0].getElementsByClassName("title")[0];let a={1:{pc:"PC / Mac:",xbox:"Xbox 360 / Xbox One:",ps:"PS3 / PS4 / PS Vita / PSVR:"},2:{pc:"PC / Mac / Linux:",xbox:"Xbox 360 / Xbox One:",ps:"PS3 / PS4:"}};s.panel.title="SHiFT Code for "+t,s.panel.setAttribute("aria-label",t),s.pcTitle.innerHTML=a[e].pc,s.xboxTitle.innerHTML=a[e].xbox,s.psTitle.innerHTML=a[e].ps}(),function(){document.getElementById("shift_header");let e=document.getElementById("panel_feed"),t={retrieved:0,total:0,new:0,exp:0};function s(e){t[e]++;let s=function(){let s="s";return 1==t[e]&&(s=""),"SHiFT Code"+s}(),a=document.getElementById("shift_header_count_"+e),n={total:s+" Available",new:"New "+s,exp:"Expiring "+s},l=t[e]+" "+n[e];a.title=l,a.setAttribute("aria-label",l),a.getElementsByClassName("count")[0].innerHTML=t[e],1==t[e]&&a.classList.remove("inactive")}function a(a){let n={};n.base=document.getElementById("panel_template").content.children[0].cloneNode(!0),n.flags={},n.flags.new=n.base.getElementsByClassName("flag new")[0],n.flags.exp=n.base.getElementsByClassName("flag exp")[0],n.header=n.base.getElementsByClassName("header")[0],n.title=n.header.getElementsByClassName("top")[0].getElementsByClassName("title")[0],n.reward=n.title.getElementsByClassName("reward")[0],n.description=n.title.getElementsByClassName("description")[0],n.progress=n.header.getElementsByClassName("bottom")[0].getElementsByClassName("progress-bar")[0],n.progressBar=n.progress.getElementsByClassName("progress")[0],n.body=n.base.getElementsByClassName("body")[0],n.relDate=n.body.getElementsByClassName("rel")[0].getElementsByClassName("content")[0],n.expDate=n.body.getElementsByClassName("exp")[0].getElementsByClassName("content")[0],n.source=n.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].firstChild,n.codePC={},n.codePC.base=n.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0],n.codePC.display=n.codePC.base.getElementsByClassName("display")[0],n.codePC.value=n.codePC.base.getElementsByClassName("value")[0],n.codePC.copy=n.codePC.base.getElementsByClassName("copy")[0],n.codeXbox={},n.codeXbox.base=n.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0],n.codeXbox.display=n.codeXbox.base.getElementsByClassName("display")[0],n.codeXbox.value=n.codeXbox.base.getElementsByClassName("value")[0],n.codeXbox.copy=n.codeXbox.base.getElementsByClassName("copy")[0],n.codePS={},n.codePS.base=n.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0],n.codePS.display=n.codePS.base.getElementsByClassName("display")[0],n.codePS.value=n.codePS.base.getElementsByClassName("value")[0],n.codePS.copy=n.codePS.base.getElementsByClassName("copy")[0];let l=getDate("yyyy-mm-dd","-");n.base.id="shift_code_"+a.codeID,function(){let e=a.reward;n.reward.innerHTML=e,e.length>20&&n.description.classList.add("long"),"5 Golden Keys"!=e&&(n.description.innerHTML="Rare SHiFT Code")}(),function(){function e(e){let t=e.substring(0,4);return e.substring(5)+"-"+t}let t=e(a.relDate),s=function(){let t=a.expDate;return null===t?(n.expDate.classList.add("inactive"),"N/A"):e(t)}();n.relDate.innerHTML=t,n.expDate.innerHTML=s,a.relDate==l?n.base.classList.add("new"):n.flags.new.remove(),a.expDate==l?n.base.classList.add("exp"):n.flags.exp.remove()}(),function(){let e=a.relDate,t=a.expDate;function s(e,t){function s(e){let t=e.replace(/-/g,", "),s=new Date(t);return s.setMonth(s.getMonth()-1),s.setHours(0,0,0),s.getTime()}let a=s(e),n=s(t);return Math.round(Math.abs((a-n)/864e5))}if(null!==t){let a=function(){let a=(s(l,e)/s(t,e)*100).toString();return-1!=a.indexOf(".")?a.match(/\d{1,2}(?=\.)/)[0]:a}(),o=function(){let e=s(l,t),a=function(){let t="";return 1!=e&&(t="s")," Day"+t+" Left"}();return e+a}();n.progress.title=o,n.progress.setAttribute("aria-label",o),n.progress.setAttribute("aria-valuenow",a),n.progressBar.style.width=a+"%"}else n.progressBar.parentNode.parentNode.remove()}(),function(){let e=a.source,t=function(){let t="Source (";return-1!=e.indexOf("facebook")?t+="Facebook":-1!=e.indexOf("twitter")&&(t+="Twitter"),t+")"}();n.source.href=e,n.source.title=t,n.source.setAttribute("aria-label",t),n.source.getElementsByClassName("text")[0].innerHTML=e}(),function(){let e=["codePC","codeXbox","codePS"];for(i=0;i<e.length;i++){let t=n[e[i]],s=a[e[i]];t.display.innerHTML=s,t.value.value=s}}(),updatePanelListeners(n.base,"setup"),function(){let o=document.getElementById("shift_overlay");e.appendChild(n.base),s("total"),updatePanelTiming(n.base,t.total),a.relDate==l?s("new"):a.expDate==l&&s("exp"),1==t.total&&vishidden(o,!0),t.total==t.retrieved&&(disenable(document.getElementById("shift_header_sort"),!1),o.remove(),document.getElementById("panel_template").remove())}()}!function(){!function e(){"function"==typeof newAjaxRequest&&"function"==typeof getDate?newAjaxRequest("GET","assets/php/scripts/shift/retrieveCodes.php?gameID="+shiftData.id,function(e){let s=JSON.parse(e).response;if(t.retrieved=s.length,t.retrieved>0)for(let e=0;e<t.retrieved;e++)a(s[e]);else{let e=document.getElementById("shift_overlay");vishidden(e.getElementsByClassName("spinner")[0],!0),vishidden(e.getElementsByClassName("error")[0],!1)}}):setTimeout(function(){e()},100)}()}()}(),document.getElementById("shift_header_sort").addEventListener("click",toggleSort);