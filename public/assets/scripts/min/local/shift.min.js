let shiftData={};function toggleSortDropdown(){let e=document.getElementById("shift_header_sort"),t=document.getElementById("shift_header_sort_dropdown"),n=t.getElementsByTagName("button"),s="true"==t.getAttribute("data-expanded");function a(){t.setAttribute("data-expanded",!s),t.setAttribute("aria-expanded",!s)}for(e.setAttribute("data-pressed",!s),e.setAttribute("data-pressed",!s),i=0;i<n.length;i++)disenable(n[i],s);!1===s?(vishidden(t,!1),window.addEventListener("click",checkSortDropdownClick),window.addEventListener("keydown",checkSortDropdownKey),setTimeout(function(){let e=t.getElementsByTagName("button");for(a(),i=0;i<e.length;i++)"true"==e[i].getAttribute("data-pressed")&&e[i].focus()},50)):(a(),window.removeEventListener("click",checkSortDropdownClick),window.removeEventListener("keydown",checkSortDropdownKey),setTimeout(function(){vishidden(t,!0),e.focus()},250))}function toggleFilterOverlay(e,t){let n=e.classList.contains("filter-overlay")?e:e.parentNode.parentNode,s=n.getAttribute("data-visible");function a(){n.setAttribute("data-visible",t)}"hover-show"==t||"button-show"==t&&"hover-show"!=s?(vishidden(n,!1),setTimeout(a,50)):("hover-hide"==t||"button-hide"==t&&"hover-show"!=s)&&(n.setAttribute("data-visible",t),setTimeout(a,250))}function updateFeedSettings(e,t){let n=document.getElementById("panel_feed"),s=document.getElementById("panel_feed_template").getElementsByClassName("panel");codes=[];let a=0,l=getDate("m-d-y","/");function o(e){n.appendChild(e),a++,updatePanelTiming(n.children[a-1],a),addPanelListeners(n.children[a-1])}if(function(){for(i=0;i<s.length;i++)codes[i]={},codes[i].panel=s[i].cloneNode(!0),codes[i].relDate=s[i].getElementsByClassName("section rel")[0].getElementsByClassName("content")[0].innerHTML,codes[i].expDate=s[i].getElementsByClassName("section exp")[0].getElementsByClassName("content")[0].innerHTML;n.innerHTML=""}(),"filter"==e){n.getAttribute("data-filter");if("none"!=t){function d(e){o(e.panel),e.used=!0}for(let e=0;e<codes.length;e++)"new"==t&&codes[e].relDate==l?d(codes[e]):"exp"==t&&codes[e].expDate==l&&d(codes[e]);for(let e=0;e<codes.length;e++)if(!0!==codes[e].used){let t={buttons:codes[e].panel.getElementsByTagName("button"),links:codes[e].panel.getElementsByTagName("a")};for(x=0;x<t.buttons.length;x++)disenable(t.buttons[x],!0);for(x=0;x<t.links.length;x++)disenable(t.links[x],!0);!function(){let t,n=document.getElementById("panel_filter_overlay_template").content.children[0].cloneNode(!0);codes[e].panel.setAttribute("data-filtered","true"),codes[e].panel.appendChild(n),t=(n=codes[e].panel.getElementsByClassName("filter-overlay")[0]).getElementsByClassName("clear")[0],n.addEventListener("mouseenter",function(e){toggleFilterOverlay(this,"hover-show")}),n.addEventListener("mouseleave",function(e){toggleFilterOverlay(this,"hover-hide")}),t.addEventListener("focus",function(e){toggleFilterOverlay(this,"button-show")}),t.addEventListener("blur",function(e){toggleFilterOverlay(this,"button-hide")}),t.addEventListener("click",function(e){updateFeedSettings("filter","none")})}(),d(codes[e])}}else updateFeedSettings("sort",n.getAttribute("data-sort"));n.setAttribute("data-filter",t),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button"),t={true:"(Click to remove filter)",false:"(Click to filter)"};for(i=0;i<e.length;i++){let s=e[i].classList[1]==n.getAttribute("data-filter"),a=e[i].title.replace(/\(.*\)/g,t[s]);e[i].setAttribute("data-pressed",s),e[i].setAttribute("aria-pressed",s),updateLabel(e[i],a)}}()}if("sort"==e){function r(e){codes=codes.sort(function(t,n){let s={new:{primary:n,secondary:t},old:{primary:t,secondary:n}};return t.relDate!=n.relDate?s[e].primary.relDate.localeCompare(s[e].secondary.relDate):s[e].primary.expDate.localeCompare(s[e].secondary.expDate)})}if("default"==t){function d(e){!0!==codes[e].used&&(o(codes[e].panel),codes[e].used=!0)}r("new");for(let e=0;e<codes.length;e++)codes[e].expDate==l&&d(e);for(let e=0;e<codes.length;e++)codes[e].relDate==l&&d(e);for(let e=0;e<codes.length;e++)"N/A"!=codes[e].expDate&&d(e);for(let e=0;e<codes.length;e++)d(e)}if("newest"==t){r("new");for(let e=0;e<codes.length;e++)o(codes[e].panel)}if("oldest"==t){r("old");for(let e=0;e<codes.length;e++)o(codes[e].panel)}!function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button");n.setAttribute("data-sort",t),setTimeout(function(){for(i=0;i<e.length;i++){let n=e[i].getAttribute("data-value")==t;e[i].setAttribute("data-pressed",n),e[i].setAttribute("aria-pressed",n)}},250)}()}}function checkSortDropdownClick(e){let t=document.getElementById("shift_header_sort_dropdown").getElementsByClassName("panel")[0],n=[e,e.target.parentNode,e.target.parentNode.parentNode,e.target.parentNode.parentNode.parentNode],s=!1;for(i=0;i<n.length;i++)if(n[i]==t){s=!0;break}!1===s&&toggleSortDropdown()}function checkSortDropdownKey(e){let t=e.target,n=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("button"),s=n[0],a=n[n.length-1];(!0===e.shiftKey&&"Tab"==e.key&&t==s||!1===e.shiftKey&&"Tab"==e.key&&t==a)&&(e.preventDefault(),t==s?a.focus():t==a&&s.focus())}function togglePanel(e){let t=e.currentTarget.parentNode.parentNode.parentNode,n={};n.body=t.getElementsByClassName("body")[0],n.body.link=n.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].getElementsByTagName("a")[0],n.body.copyPC=n.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyXbox=n.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0],n.body.copyPS=n.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0].getElementsByClassName("copy")[0];let s="true"==t.getAttribute("data-expanded");t.setAttribute("data-expanded",!s),t.setAttribute("aria-expanded",!s),updateLabel(e.currentTarget,{true:"Collapse SHiFT Code",false:"Expand SHiFT Code"}[!s])}function copyCode(e){e.parentNode.getElementsByClassName("value")[0].select(),document.execCommand("copy"),e.classList.remove("animated"),setTimeout(function(){e.classList.add("animated")},1)}function updatePanelTiming(e,t){e.style.animationDelay=.2*(t-1)+"s"}function addPanelListeners(e){let t=e.getElementsByClassName("toggle")[0],n=e.getElementsByClassName("copy");for(t.addEventListener("click",togglePanel),i=0;i<n.length;i++)n[i].addEventListener("click",function(e){copyCode(this)})}shiftData.base=JSON.parse(document.body.getAttribute("data-shiftData")),shiftData.id=shiftData.base.id,shiftData.name=shiftData.base.name,function(){document.getElementById("shift_header");let e=document.getElementById("panel_feed"),t={retrieved:0,total:0,new:0,exp:0};function n(e){t[e]++;let n=function(){let n="s";return 1==t[e]&&(n=""),"SHiFT Code"+n}(),s=document.getElementById("shift_header_count_"+e),a={total:n+" Available",new:"New "+n,exp:"Expiring "+n},l="total"==e?"":" (Click to filter)";updateLabel(s,t[e]+" "+a[e]+l),s.getElementsByClassName("count")[0].innerHTML=t[e],1==t[e]&&(disenable(s,!1),s.classList.remove("inactive"))}function s(s){let a={};a.base=document.getElementById("panel_template").content.children[0].cloneNode(!0),a.flags={},a.flags.new=a.base.getElementsByClassName("flag new")[0],a.flags.exp=a.base.getElementsByClassName("flag exp")[0],a.header=a.base.getElementsByClassName("header")[0],a.title=a.header.getElementsByClassName("top")[0].getElementsByClassName("title")[0],a.reward=a.title.getElementsByClassName("reward")[0],a.description=a.title.getElementsByClassName("description")[0],a.progress=a.header.getElementsByClassName("bottom")[0].getElementsByClassName("progress-bar")[0],a.progressBar=a.progress.getElementsByClassName("progress")[0],a.body=a.base.getElementsByClassName("body")[0],a.relDate=a.body.getElementsByClassName("rel")[0].getElementsByClassName("content")[0],a.expDate=a.body.getElementsByClassName("exp")[0].getElementsByClassName("content")[0],a.source=a.body.getElementsByClassName("src")[0].getElementsByClassName("content")[0].firstChild,a.notes=a.body.getElementsByClassName("notes")[0].getElementsByClassName("content")[0],a.codePC={},a.codePC.title=a.body.getElementsByClassName("pc")[0].getElementsByClassName("title")[0],a.codePC.base=a.body.getElementsByClassName("pc")[0].getElementsByClassName("content")[0],a.codePC.display=a.codePC.base.getElementsByClassName("display")[0],a.codePC.value=a.codePC.base.getElementsByClassName("value")[0],a.codePC.copy=a.codePC.base.getElementsByClassName("copy")[0],a.codeXbox={},a.codeXbox.title=a.body.getElementsByClassName("xbox")[0].getElementsByClassName("title")[0],a.codeXbox.base=a.body.getElementsByClassName("xbox")[0].getElementsByClassName("content")[0],a.codeXbox.display=a.codeXbox.base.getElementsByClassName("display")[0],a.codeXbox.value=a.codeXbox.base.getElementsByClassName("value")[0],a.codeXbox.copy=a.codeXbox.base.getElementsByClassName("copy")[0],a.codePS={},a.codePS.title=a.body.getElementsByClassName("ps")[0].getElementsByClassName("title")[0],a.codePS.base=a.body.getElementsByClassName("ps")[0].getElementsByClassName("content")[0],a.codePS.display=a.codePS.base.getElementsByClassName("display")[0],a.codePS.value=a.codePS.base.getElementsByClassName("value")[0],a.codePS.copy=a.codePS.base.getElementsByClassName("copy")[0];let l=getDate();a.base.id="shift_code_"+s.codeID,function(){let e=s.reward;a.reward.innerHTML=e,e.length>20&&a.description.classList.add("long"),"5 Golden Keys"!=e&&(a.description.innerHTML="Rare SHiFT Code")}(),function(){function e(e){let t=e.substring(0,4);return(e.substring(5)+"/"+t).replace(/-/g,"/")}let t=getDate("m-d-y","/"),n=e(s.relDate),l=function(){let t=s.expDate;return null===t?(a.expDate.classList.add("inactive"),"N/A"):e(t)}();a.relDate.innerHTML=n,a.expDate.innerHTML=l,t==n?a.base.classList.add("new"):a.flags.new.remove(),t==l?a.base.classList.add("exp"):a.flags.exp.remove(),function(){function e(e,t){let n={start:new Date(e),end:new Date(t)},s=Math.abs(n.end.getTime()-n.start.getTime());return Math.ceil(s/864e5)}function s(e,t){updateLabel(a.progress,e),a.progress.setAttribute("aria-valuenow",t),a.progressBar.style.width=t+"%"}if("N/A"!=l){let a=function(){let s=(e(t,n)/e(l,n)*100).toString();return-1!=s.indexOf(".")?s.match(/\d{1,2}(?=\.)/)[0]:s}();s(function(){let n=e(t,l),s=function(){let e="";return 1!=n&&(e="s")," Day"+e+" Left"}();return n+s}(),a)}else s("No Expiration Date",0),a.progress.classList.add("inactive")}()}(),function(){let e=s.source;if(null!==e){let t=function(){let t="Source";return-1!=e.indexOf("facebook")?t+=" (Facebook)":-1!=e.indexOf("twitter")&&(t+=" (Twitter)"),t}();a.source.href=e,a.source.getElementsByClassName("text")[0].innerHTML=e,updateLabel(a.source,t)}else{let e=document.createElement("span"),t=a.source.parentNode;e.innerHTML="N/A",updateLabel(e,"No confirmed source available"),t.appendChild(e),t.classList.add("inactive"),a.source.remove()}}(),function(){let e=s.notes;null!==e&&(a.base.setAttribute("data-extraInfo",!0),a.notes.parentNode.classList.remove("inactive"),a.notes.innerHTML=-1==e.indexOf("-")?"<li><i>"+e+"</i></li>":e.replace(/-.*/g,function(e){return e.replace(/-\s{1}/g,"<li><i>")+"</i></li>"}))}(),function(){let e=["PC","Xbox","PS"];for(i=0;i<e.length;i++){let t=a["code"+e[i]],n=s["code"+e[i]];t.title.innerHTML=s["platforms"+e[i]]+":",t.display.innerHTML=n,t.value.value=n}}(),addPanelListeners(a.base),function(){let o=document.getElementById("shift_overlay");if(e.appendChild(a.base),n("total"),updatePanelTiming(a.base,t.total),s.relDate==l?n("new"):s.expDate==l&&n("exp"),1==t.total&&vishidden(o,!0),t.total==t.retrieved)for(addFocusScrollListeners(e),disenable(document.getElementById("shift_header_sort"),!1),o.remove(),document.getElementById("panel_template").remove(),i=0;i<e.children.length;i++){let t=e.children[i].cloneNode(!0);document.getElementById("panel_feed_template").appendChild(t)}}()}!function(){!function e(){"function"==typeof newAjaxRequest&&"function"==typeof getDate?newAjaxRequest("GET","assets/php/scripts/shift/retrieveCodes.php?gameID="+shiftData.id,function(e){let n=JSON.parse(e).response;if(t.retrieved=n.length,t.retrieved>0)for(let e=0;e<t.retrieved;e++)s(n[e]);else{let e=document.getElementById("shift_overlay");vishidden(e.getElementsByClassName("spinner")[0],!0),vishidden(e.getElementsByClassName("error")[0],!1)}}):setTimeout(function(){e()},100)}()}()}(),document.getElementById("shift_header_sort").addEventListener("click",toggleSortDropdown),function(){let e=document.getElementById("shift_header").getElementsByClassName("counters")[0].getElementsByTagName("button");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.classList[1];t!=document.getElementById("panel_feed").getAttribute("data-filter")?updateFeedSettings("filter",t):updateFeedSettings("filter","none")})}(),function(){let e=document.getElementById("shift_header_sort_dropdown").getElementsByTagName("BUTTON");for(i=0;i<e.length;i++)e[i].addEventListener("click",function(e){let t=this.getAttribute("data-value");t!=document.getElementById("panel_feed").getAttribute("data-filter")&&updateFeedSettings("sort",t),toggleSortDropdown()})}();